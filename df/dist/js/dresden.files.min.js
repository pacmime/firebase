"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();!function(e){e.module("dresden.common",[]).constant("DataStoreUrl","https://intense-fire-8692.firebaseio.com/DresdenFiles").factory("DataStore",["$firebaseObject","DataStoreUrl",function(e,t){return{getCharsForUser:function(t){var n=firebase.database().ref(),i=n.child("DresdenFiles").child("chars");return i.orderByChild("uid").equalTo(t),e(i)}}}]).factory("CharacterRef",["$firebaseObject","DataStoreUrl",function(e,t){return function(t){var n=firebase.database().ref(),i=n.child("DresdenFiles").child("chars").child(t);return e(i)}}]).filter("encode",function(){return function(e){return encodeURIComponent(e)}}).filter("decode",function(){return function(e){return decodeURIComponent(e)}}).provider("responsiveHelper",["$windowProvider",function(e){function t(e){this.window=e}var n=e.$get();t.prototype={getWidth:function(){return n.innerWidth||n.outerWidth},isXS:function(){var e=this.getWidth();return e<768},isSM:function(){var e=this.getWidth();return e>=768&&e<992},isMD:function(){var e=this.getWidth();return e>=992&&e<1200},isLG:function(){var e=this.getWidth();return e>=1200}};var i=new t(n);this.$get=function(){return i}}]).directive("responsive",["$window","responsiveHelper",function(t,n){return{restrict:"A",link:function(i,a,s){function o(e,t){t.isXS()?e.addClass("responsive-xs"):e.removeClass("responsive-xs"),t.isSM()?e.addClass("responsive-sm"):e.removeClass("responsive-sm"),t.isMD()?e.addClass("responsive-md"):e.removeClass("responsive-md"),t.isLG()?e.addClass("responsive-lg"):e.removeClass("responsive-lg")}o(a,n);var r=function(){o(a,n)},l=e.element(t);l.on("resize",r);i.$on("$destroy",function(){l.off("resize",r)})}}}]).controller("KeyPad",["$scope","$uibModalInstance","value","minimum","maximum",function(e,t,n,i,a){e.value=n,e.minimum=1*i||0,e.maximum=1*a||9999,e.change=function(t){t>0?e.value=Math.min(e.value+t,a):e.value=Math.max(e.value+t,i)},e.ok=function(){t.close(e.value)},e.cancel=function(){t.dismiss("cancel")}}]).directive("editableStatValue",["$uibModal",function(e){return{scope:{onSave:"&",minimum:"@",maximum:"@"},restrict:"A",require:"ngModel",replace:!0,template:'<div class="value" ng-click="openKeypad()">{{display}}</div>',link:function(t,n,i,a){t.minimum=1*(t.minimum||0),t.maximum=1*(t.maximum||9999),a.$render=function(){t.display=a.$viewValue},t.openKeypad=function(){var n=a.$modelValue||0,i=e.open({templateUrl:"src/keypad.html",controller:"KeyPad",animation:!1,resolve:{value:function(){return n},minimum:function(){return t.minimum},maximum:function(){return t.maximum}}});i.result.then(function(e){a.$setViewValue(e),a.$render(),t.onSave&&t.onSave()},function(){})}}}}]).directive("editableInput",["$timeout",function(e){return{restrict:"AE",require:"ngModel",scope:{label:"@",onSave:"&"},replace:!0,template:['<div class="editable-input">','  <label class="editable-input-label">{{::label}}</label>','  <span class="editable-input-display" ng-show="!editing" ng-click="edit()"></span>','    <form class="form" ng-show="editing">','      <div class="form-group">','        <div class="grid">','          <div class="grid__col-auto grid__col--grow-2">','            <input type="text" class="form-control editable-input-field" ','              ng-keyup="onKeyUp($event, $event.keyCode)"></input>',"          </div>",'          <div class="grid__col-auto">','            <div class="editable-input-buttons">','              <button type="button" class="btn btn-xs btn-link text-success" ng-disabled="error" ng-click="done()" tabindex="0">','                <span class="glyphicon glyphicon-ok"></span>',"              </button>",'              <button type="button" class="btn btn-xs btn-link text-danger" ng-click="cancel()"  tabindex="0">','                <span class="glyphicon glyphicon-remove"></span>',"              </button>","            </div>","          </div>","        </div>","      </div>","    </form>","</div>"].join(" "),link:function(t,n,i,a){function s(e){a.$setViewValue(e),a.$render()}a.$render=function(){var e=a.$viewValue,t=e&&e.length&&e.trim().length?e:"Please enter a value";n.find(".editable-input-display").text(t),n.find(".editable-input-field").val(e)},t.edit=function(){t.editing=!0,e(function(){n.find(".editable-input-field").focus().select()},200)},t.done=function(){var e=n.find(".editable-input-field").val();s(e),t.editing=!1,t.onSave()},t.cancel=function(){n.find(".editable-input-field").val(a.$viewValue),t.editing=!1},t.onKeyUp=function(e,n){void 0!==n&&0!==n||void 0===e.which||(n=e.which),13!==n||t.error?27===n&&t.cancel():t.done()}}}}]).directive("imgSelector",function(){function e(e,t){function n(e){var n=btoa(e.target.result);i.base64=n,t(i)}var i={},a=new FileReader;a.onload=n;var e=e[0].files[0];return e.size>1e5?(alert("Image is too large, should be less than 100 KB"),void t(null)):(i.filetype=e.type,i.size=e.size,i.filename=e.name,void a.readAsBinaryString(e))}return{scope:{onSave:"&"},require:"ngModel",template:['<form class="img-selector">','  <div class="image" title="click to change">','    <img src="assets/avatar.png">',"  </div>",'  <button type="button" class="btn btn-sm btn-success" ','    ng-if="imgData && isDirty()" ng-click="save()">save</button>','  <input type="file" class="hidden">',"</form>"].join(" "),link:function(t,n,i,a){function s(){if(t.imgData){var e='<img alt="avatar" src="'+t.imgData+'">';n.find(".image").html(e)}}function o(){console.log("selecting file"),e(n.find("input"),function(e){return e?void t.$apply(function(){t.imgData="data:"+e.filetype+";base64,"+e.base64,s(),a.$setDirty()}):void n.find("form")[0].reset()})}t.isDirty=function(){return a.$dirty},t.save=function(){a.$setViewValue(t.imgData),a.$setPristine(),t.onSave()};var r=n.find("input");n.find(".image").on("click",function(){r.trigger("click")}),r.on("change",o),a.$render=function(){t.imgData||(t.imgData=a.$viewValue,s())}}}}).controller("LoginController",["$scope","$uibModalInstance","Auth",function(e,t,n){e.login=function(){n.$signInWithEmailAndPassword(e.email,e.password).then(function(e){t.close()}).catch(function(e){var t=(e.code,e.message);console.log("unable to login: "+t)})},e.cancel=function(){t.dismiss("cancel")}}]).component("login",{template:['<a ng-if="!$ctrl.user" ng-click="$ctrl.doLogin()">Login</a>','<a ng-if="$ctrl.user" class="dropdown-toggle" data-toggle="dropdown" ','  role="button" aria-haspopup="true" aria-expanded="false">','  <span class="hidden-xs">{{$ctrl.user.email}}</span> ','  <span class="visible-xs-inline-block glyphicon glyphicon-user"></span>','  <span class="caret"></span>',"</a>",'<ul ng-if="$ctrl.user" class="dropdown-menu">','  <li><a ng-click="$ctrl.doReset()">Reset Password</a></li>','  <li><a ng-click="$ctrl.doLogout()">Log out</a></li>',"</ul>","</div>"].join(" "),controller:["$uibModal","$firebaseAuth",function(e,t){var n=this;this.$onInit=function(){n.auth=t(),n.auth.$onAuthStateChanged(function(e){return n.user=e})},this.$onDestroy=function(){n.auth=null},this.doLogout=function(){n.auth.$signOut(),n.user=null},this.doLogin=function(){var t=n,i=e.open({templateUrl:"login.html",controller:"LoginController",resolve:{Auth:function(){return t.auth}}});i.result.then(function(){},function(){})},this.doReset=function(){auth.$sendPasswordResetEmail(n.user.email,function(e){null===e?alert("Password reset email sent"):alert("Error sending password reset email:",e)})}}]}).constant("Templates",["Pure Mortal","Champion of God","Changeling","Emissary of Power","Focused Practitioner","Knights of a Faerie Court","Lycanthrope","Minor Talent","Red Court Infected","Sorcerer","True Believer","Were-Form","White Court Vampire","White Court Virgin","Wizard"]).constant("CharacterShell",{name:"",template:"",fatePoints:0,powerLevel:"",skillCap:0,baseRefresh:0,adjustedRefresh:0,aspects:{highConcept:"",trouble:"",other:""},stress:{physical:{0:!1,1:!1,2:!1},mental:{0:!1,1:!1,2:!1},social:{0:!1,1:!1,2:!1},armor:{}},consequences:{},skills:{total:0,spent:0,superb:{choices:""},great:{choices:""},good:{choices:""},fair:{choices:""},average:{choices:""}},powers:{},phases:{background:{events:"",aspect:""},conflict:{events:"",aspect:""},story:{events:"",aspect:"",title:"",guest:""},guest1:{events:"",aspect:"",title:"",guest:""},guest2:{events:"",aspect:"",title:"",guest:""}},notes:""})}(angular),function(e){e.module("dresden",["firebase","ui.router","ui.bootstrap","ngAnimate","dresden.common","dresden.home","dresden.char"]).config(["$locationProvider","$urlRouterProvider",function(e,t){t.otherwise("/")}]),window.show=function(e,t){$(".c-card").removeClass("is-shown"),$(e).addClass("is-shown");var n=$(t);n.addClass("active"),n.siblings().removeClass("active")}}(angular),function(e){e.module("dresden.home",["firebase","dresden.common"]).config(["$stateProvider",function(e){e.state({name:"home",url:"/",template:"<home></home>"})}])}(angular),function(e){var t=function(){function t(e,n,i){"ngInject";_classCallCheck(this,t),this.store=e,this.auth=n()}return t.$inject=["DataStore","$firebaseAuth","$timeout"],_createClass(t,[{key:"$onInit",value:function(){var e=this;this.displayOpts={loading:!1,message:null,error:null};var t=function(){e.updateList(),e.displayOpts.loading=!1},n=function(t){return e.displayOpts.error="Failed to load saved data: "+t.data},i=function(i){e.user=i,i&&i.uid?(e.displayOpts.loading=!0,e.data=e.store.getCharsForUser(i.uid),e.data.$loaded().then(t).catch(n)):e.data&&e.data.$destroy()};this.auth.$onAuthStateChanged(i)}},{key:"updateList",value:function(){if(this.user){var t=this.user.uid,n=[];e.forEach(this.data,function(e,i){e.userId&&e.userId===t&&n.push(i)}),this.chars=n}}},{key:"createCharacter",value:function(){var e=prompt("Name the character","Joe Bob");if(!e)return void alert("Characters must have a name");if(this.data[e])return void alert("Name is already in use");var t=getCharacterShell();t.userId=$scope.user.uid,this.data[e]=t,this.data.$save().then(function(){window.location="#/"+encodeURIComponent(e)}).catch(function(e){alert("Unable to create character because of an error")})}}]),t}();e.module("dresden.home").component("home",{templateUrl:"home/home.component.html",controller:t})}(angular),function(e){e.module("dresden.char",["firebase"]).config(["$stateProvider",function(e){e.state({name:"char",url:"/chars/:id",template:"<character></character>"})}]).constant("PowerLevels",{"Feet in the Water":{skillCap:4,baseRefresh:6},"Waist Deep":{skillCap:4,baseRefresh:8},Other:{skillCap:5,baseRefresh:10}})}(angular),function(e){var t=function(){function t(e,n,i,a,s,o){"ngInject";_classCallCheck(this,t),this.charId=o.id,this.store=e,this.auth=a(),this.levels=n,this.templates=i,this.timeout=s}return t.$inject=["CharacterRef","PowerLevels","Templates","$firebaseAuth","$timeout","$stateParams"],_createClass(t,[{key:"$onInit",value:function(){var e=this;this.displayOpts={loading:!1,message:null,error:null};var t=function(){e.displayOpts.loading=!1,e.refresh()},n=function(t){return e.displayOpts.error="Failed to load character: "+t.data},i=function(i){e.user=i,i&&i.uid?(e.displayOpts.loading=!0,e.character=e.store(e.charId),e.character.$loaded().then(t).catch(n)):e.character&&e.character.$destroy()};this.auth.$onAuthStateChanged(i)}},{key:"$onDestroy",value:function(){this.charId=null,this.store=null,this.auth=null,this.levels=null,this.templates=null,this.timeout=null}},{key:"refresh",value:function(){var t=0;e.forEach(this.character.powers,function(e){t+=e.cost}),this.adjustedRefresh=this.character.baseRefresh+t}},{key:"onPowerLevelChange",value:function(){var e=this.levels[this.character.powerLevel];this.character.skillCap=e.skillCap,this.character.baseRefresh=e.baseRefresh,this.refresh(),this.save()}},{key:"save",value:function(){var e=this;this.debounce&&(this.timeout.cancel(this.debounce),this.debounce=null),this.debounce=this.timeout(function(){e.debounce=null,e.character.$save().then(function(){e.displayOpts.showSave=!0,e.timeout(function(){e.displayOpts.showSave=!1},1500)},function(e){alert("There was an error")})},250)}}]),t}();e.module("dresden.char").component("character",{templateUrl:"char/char.component.html",controller:t})}(angular),function(e){var t=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"$onInit",value:function(){this.displayOpts={}}},{key:"getConsequences",value:function(){var e=[];if(this.ngModel)for(var t in this.ngModel)e.push(this.ngModel[t]);return e.sort(function(e,t){return e.type===t.type?e.aspect<t.aspect:"mild"===e.type?-1:"mild"===t.type?1:"moderate"===e.type?-1:"moderate"===t.type?1:"severe"===e.type?-1:"severe"===t.type?1:0})}},{key:"removeConsequence",value:function(e){e&&(this.ngModel[e.aspect]=null,this.onChange())}},{key:"showConsequenceEditor",value:function(){this.newConsequence={aspect:"",type:"mild",modifier:-2},this.displayOpts.showConsequenceEditor=!0}},{key:"addConsequence",value:function(){this.ngModel=this.ngModel||{},this.ngModel[this.newConsequence.aspect]=this.newConsequence,this.onChange(),this.hideConquenceEditor()}},{key:"hideConquenceEditor",value:function(){this.newConsequence=null,this.displayOpts.showConsequenceEditor=!1}},{key:"updateNewConsequenceModifier",value:function(){var e=this.newConsequence.type,t="mild"===e?-2:"moderate"===e?-4:"severe"===e?-6:-8;this.newConsequence.modifier=t}}]),e}();e.module("dresden.char").component("consequences",{bindings:{ngModel:"=",onChange:"&"},templateUrl:"char/consequences.component.html",controller:t})}(angular),function(e){var t=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"$onInit",value:function(){this.displayOpts={}}},{key:"removePower",value:function(e){this.ngModel[e]=null,this.onChange()}},{key:"showEditor",value:function(){this.newPower={name:"",cost:0,misc:""},this.displayOpts.showEditor=!0}},{key:"addPower",value:function(){this.ngModel=this.ngModel||{},this.ngModel[this.newPower.name]=this.newPower,this.onChange(),this.hideEditor()}},{key:"hideEditor",value:function(){this.newPower=null,this.displayOpts.showEditor=!1}}]),e}();e.module("dresden.char").component("powers",{bindings:{ngModel:"=",onChange:"&"},templateUrl:"char/powers.component.html",controller:t})}(angular),function(e){var t=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"$onInit",value:function(){}},{key:"getSkillSlots",value:function(e){if(!this.ngModel||!this.ngModel[e])return 0;var t=this.ngModel[e].choices;return t&&t.length?t.split(",").length:0}},{key:"validateSpent",value:function(){if(!this.ngModel)return!1;var e=this.getSkillSlots("average")+this.getSkillSlots("fair")+this.getSkillSlots("good")+this.getSkillSlots("great")+this.getSkillSlots("superb");return e>this.ngModel.total}},{key:"validate",value:function(e){if(!this.ngModel)return!1;switch(e){case"superb":return this.getSkillSlots("superb")>this.getSkillSlots("great");case"great":return this.getSkillSlots("great")>this.getSkillSlots("good");case"good":return this.getSkillSlots("good")>this.getSkillSlots("fair");case"fair":return this.getSkillSlots("fair")>this.getSkillSlots("average")}return!1}}]),e}();e.module("dresden.char").component("skills",{bindings:{ngModel:"=",onChange:"&"},templateUrl:"char/skills.component.html",controller:t})}(angular),function(e){var t=function(){function t(){_classCallCheck(this,t)}return _createClass(t,[{key:"$onInit",value:function(){}},{key:"resetStress",value:function(){var t=this;e.forEach(["physical","mental","social","hunger"],function(e){for(var n=t.ngModel[e].threshold,i=t.ngModel[e].used,a=0;a<n;++a)i[a]=!1}),this.onChange()}},{key:"toggleStress",value:function(e,t){this.ngModel[e].used[t]=!this.ngModel[e].used[t],this.onChange()}}]),t}();e.module("dresden.char").component("stress",{bindings:{ngModel:"=",onChange:"&"},templateUrl:"char/stress.component.html",controller:t})}(angular);
//# sourceMappingURL=dresden.files.min.js.map
