{"version":3,"sources":["dresden.files.js","common.js","app.js","home.module.js","home.component.js","sidebar.component.js","char.module.js","aspects.component.js","char.component.js","consequences.component.js","items.component.js","phases.component.js","powers.component.js","skills.component.js","stress.component.js"],"names":["_classCallCheck","instance","Constructor","TypeError","_createClass","defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","protoProps","staticProps","prototype","angular","module","constant","factory","$firebaseObject","DataStoreUrl","getCharsForUser","uid","root","firebase","database","ref","child","orderByChild","equalTo","name","$q","getUserData","deferred","defer","user","$loaded","exists","$value","resolve","set","chars","promise","getCharacter","createCharacter","character","filter","value","encodeURIComponent","decodeURIComponent","provider","$windowProvider","Helper","$window","this","window","$get","getWidth","innerWidth","outerWidth","isXS","width","isSM","isMD","isLG","helper","directive","responsiveHelper","restrict","link","$scope","$element","$attrs","update","el","addClass","removeClass","resizeFn","w","element","on","$on","off","controller","$uibModalInstance","minimum","maximum","change","v","Math","min","max","ok","close","cancel","dismiss","$uibModal","scope","onSave","require","replace","template","ngModelController","$render","display","$viewValue","openKeypad","$modelValue","modalInstance","open","templateUrl","animation","result","then","$setViewValue","$timeout","label","join","newValue","trim","find","text","val","edit","editing","focus","select","done","onKeyUp","$event","code","undefined","which","error","base64","file","callback","readerOnload","e","btoa","coolFile","reader","FileReader","onload","files","size","alert","filetype","type","filename","readAsBinaryString","imgData","image","html","onFileSelect","console","log","data","$apply","$setDirty","reset","isDirty","$dirty","save","$setPristine","filePicker","trigger","Auth","$","email","password","login","$signInWithEmailAndPassword","authData","errorMessage","catch","message","component","$firebaseAuth","_this","$onInit","auth","$onAuthStateChanged","$onDestroy","doLogout","$signOut","doLogin","self","doReset","$sendPasswordResetEmail","_this2","fatePoints","powerLevel","skillCap","baseRefresh","adjustedRefresh","aspects","highConcept","trouble","other","stress","physical","0","1","2","mental","social","armor","consequences","skills","total","spent","superb","choices","great","good","fair","average","powers","phases","background","events","aspect","conflict","story","title","guest","guest1","guest2","notes","config","$locationProvider","$urlRouterProvider","otherwise","show","selector","btn","$btn","siblings","$stateProvider","state","url","HomeController","DataStore","CharacterShell","$state","store","blankChar","_this3","displayOpts","loading","loadback","updateList","errback","$destroy","id","forEach","userId","push","_this4","prompt","json","copy","$save","go","_this5","NavController","DataStore2","timeout","_this6","_this7","_this8","Feet in the Water","Waist Deep","Other","AspectsController","cache","ngModel","onChange","bindings","CharController","CharacterRef","PowerLevels","Templates","$stateParams","charId","levels","templates","_this9","refresh","cost","power","level","_this10","debounce","showSave","ConsequencesController","sort","a","b","consq","newConsequence","modifier","showConsequenceEditor","hideConquenceEditor","mod","ItemsController","editingItem","newItem","hideEditor","item","PhasesController","phase","property","PowersController","newPower","misc","showEditor","SkillsController","group","split","getSkillSlots","StressController","_this11","threshold","used","index"],"mappings":"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","file":"dresden.files.min.js","sourcesContent":["'use strict';\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\n(function (angular) {\n    \"use strict\";\n\n    angular.module('dresden.common', []).constant('DataStoreUrl', \"https://intense-fire-8692.firebaseio.com/DresdenFiles\").factory(\"DataStore\", [\"$firebaseObject\", 'DataStoreUrl', function ($firebaseObject, DataStoreUrl) {\n        return {\n            getCharsForUser: function getCharsForUser(uid) {\n                var root = firebase.database().ref();\n                var ref = root.child('DresdenFiles').child('chars');\n                ref.orderByChild('uid').equalTo(uid);\n                return $firebaseObject(ref);\n            }\n        };\n    }]).factory(\"CharacterRef\", [\"$firebaseObject\", 'DataStoreUrl', function ($firebaseObject, DataStoreUrl) {\n        return function (name) {\n            var root = firebase.database().ref();\n            var ref = root.child('DresdenFiles').child('chars').child(name);\n            return $firebaseObject(ref);\n        };\n    }]).factory(\"DataStore2\", [\"$q\", \"$firebaseObject\", 'DataStoreUrl', function ($q, $firebaseObject, DataStoreUrl) {\n        return {\n\n            getUserData: function getUserData(uid) {\n\n                var deferred = $q.defer();\n\n                // var root = firebase.database().ref().child('DresdenFiles/users');\n                // var users = $firebaseObject(root);\n                // users.$loaded(function() {\n\n                //     if(!users[uid]) {\n\n                //         users[uid] = { chars: {} };\n                //         users.$save().then(function() {\n                //             deferred.resolve($firebaseObject(users[uid]));\n                //         }, function(error) {\n                //             deferred.reject(error);\n                //         });  \n                //     } else {\n                //         deferred.resolve($firebaseObject(users[uid]));\n                //     }\n\n                // });\n\n                var ref = firebase.database().ref().child('DresdenFiles/users/' + uid);\n                var user = $firebaseObject(ref);\n                user.$loaded(function () {\n                    var exists = user.$value !== null;\n                    if (exists) {\n                        deferred.resolve(user);\n                        return;\n                    }\n\n                    var root = firebase.database().ref().child('DresdenFiles/users');\n                    root.child(uid).set({\n                        chars: {},\n                        uid: uid\n                    });\n\n                    user = $firebaseObject(root.child(uid));\n                    deferred.resolve(user);\n                });\n\n                return deferred.promise;\n            },\n\n            getCharsForUser: function getCharsForUser(uid) {\n                var ref = firebase.database().ref().child('DresdenFiles/users/' + uid + '/chars');\n                return $firebaseObject(ref);\n            },\n\n            getCharacter: function getCharacter(uid, name) {\n                var ref = firebase.database().ref().child('DresdenFiles/users/' + uid + '/chars/' + name);\n                return $firebaseObject(ref);\n            },\n\n            createCharacter: function createCharacter(uid, character) {\n\n                var ref = firebase.database().ref().child('DresdenFiles/users/' + uid + '/chars');\n                ref.child(character.name).set(character);\n                return $firebaseObject(ref.child(character.name));\n            }\n        };\n    }]).filter('encode', function () {\n        return function (value) {\n            return encodeURIComponent(value);\n        };\n    }).filter('decode', function () {\n        return function (value) {\n            return decodeURIComponent(value);\n        };\n    }).provider('responsiveHelper', [\"$windowProvider\", function ($windowProvider) {\n\n        var $window = $windowProvider.$get();\n\n        function Helper($window) {\n            this.window = $window;\n        }\n        Helper.prototype = {\n            getWidth: function getWidth() {\n                return $window.innerWidth || $window.outerWidth;\n            },\n            isXS: function isXS() {\n                var width = this.getWidth();return width < 768;\n            },\n            isSM: function isSM() {\n                var width = this.getWidth();return width >= 768 && width < 992;\n            },\n            isMD: function isMD() {\n                var width = this.getWidth();return width >= 992 && width < 1200;\n            },\n            isLG: function isLG() {\n                var width = this.getWidth();return width >= 1200;\n            }\n        };\n\n        var helper = new Helper($window);\n\n        this.$get = function () {\n            return helper;\n        };\n    }])\n\n    //directive which appends appropriate responsive breakpoint classNames to the element\n    // on which it's set\n    .directive('responsive', ['$window', 'responsiveHelper', function ($window, responsiveHelper) {\n\n        return {\n            restrict: \"A\",\n            link: function link($scope, $element, $attrs) {\n\n                function update(el, helper) {\n                    if (helper.isXS()) el.addClass('responsive-xs');else el.removeClass('responsive-xs');\n\n                    if (helper.isSM()) el.addClass('responsive-sm');else el.removeClass('responsive-sm');\n\n                    if (helper.isMD()) el.addClass('responsive-md');else el.removeClass('responsive-md');\n\n                    if (helper.isLG()) el.addClass('responsive-lg');else el.removeClass('responsive-lg');\n                }\n\n                update($element, responsiveHelper);\n\n                var resizeFn = function resizeFn() {\n                    update($element, responsiveHelper);\n                };\n\n                var w = angular.element($window);\n                var listener = w.on('resize', resizeFn);\n\n                $scope.$on('$destroy', function () {\n                    w.off('resize', resizeFn);\n                });\n            }\n        };\n    }]).controller('KeyPad', function ($scope, $uibModalInstance, value, minimum, maximum) {\n\n        $scope.value = value;\n        $scope.minimum = minimum * 1 || 0;\n        $scope.maximum = maximum * 1 || 9999;\n\n        $scope.change = function (v) {\n            if (v > 0) $scope.value = Math.min($scope.value + v, maximum);else $scope.value = Math.max($scope.value + v, minimum);\n        };\n\n        $scope.ok = function () {\n            $uibModalInstance.close($scope.value);\n        };\n\n        $scope.cancel = function () {\n            $uibModalInstance.dismiss('cancel');\n        };\n    }).directive('editableStatValue', ['$uibModal', function ($uibModal) {\n        return {\n            scope: {\n                onSave: '&',\n                minimum: '@',\n                maximum: '@'\n            },\n            restrict: 'A',\n            require: 'ngModel',\n            replace: true,\n            template: '<div class=\"value\" ng-click=\"openKeypad()\">{{display}}</div>',\n            link: function link($scope, $element, $attrs, ngModelController) {\n\n                $scope.minimum = ($scope.minimum || 0) * 1;\n                $scope.maximum = ($scope.maximum || 9999) * 1;\n\n                ngModelController.$render = function () {\n                    $scope.display = ngModelController.$viewValue;\n                };\n\n                $scope.openKeypad = function () {\n\n                    var _value = ngModelController.$modelValue || 0;\n\n                    var modalInstance = $uibModal.open({\n                        templateUrl: 'src/keypad.html',\n                        controller: 'KeyPad',\n                        animation: false,\n                        resolve: {\n                            value: function value() {\n                                return _value;\n                            },\n                            minimum: function minimum() {\n                                return $scope.minimum;\n                            },\n                            maximum: function maximum() {\n                                return $scope.maximum;\n                            }\n                        }\n                    });\n\n                    modalInstance.result.then(function (value) {\n\n                        ngModelController.$setViewValue(value);\n                        ngModelController.$render();\n                        if ($scope.onSave) $scope.onSave();\n                    }, function () {});\n                };\n            }\n        };\n    }]).directive('editableInput', ['$timeout', function ($timeout) {\n\n        return {\n            restrict: 'AE',\n            require: 'ngModel',\n            scope: {\n                label: \"@\",\n                onSave: \"&\"\n            },\n            replace: true,\n            template: ['<div class=\"editable-input\">', '  <label class=\"editable-input-label\">{{::label}}</label>', '  <span class=\"editable-input-display\" ng-show=\"!editing\" ng-click=\"edit()\"></span>', '    <form class=\"form\" ng-show=\"editing\">', '      <div class=\"form-group\">', '        <div class=\"grid\">', '          <div class=\"grid__col-auto grid__col--grow-2\">', '            <input type=\"text\" class=\"form-control editable-input-field\" ', '              ng-keyup=\"onKeyUp($event, $event.keyCode)\"></input>', '          </div>', '          <div class=\"grid__col-auto\">', '            <div class=\"editable-input-buttons\">', '              <button type=\"button\" class=\"btn btn-xs btn-link text-success\" ng-disabled=\"error\" ng-click=\"done()\" tabindex=\"0\">', '                <span class=\"glyphicon glyphicon-ok\"></span>', '              </button>', '              <button type=\"button\" class=\"btn btn-xs btn-link text-danger\" ng-click=\"cancel()\"  tabindex=\"0\">', '                <span class=\"glyphicon glyphicon-remove\"></span>', '              </button>', '            </div>', '          </div>', '        </div>', '      </div>', '    </form>', '</div>'].join(' '),\n\n            link: function link($scope, $element, $attrs, ngModelController) {\n\n                function update(newValue) {\n                    // call $parsers pipeline then update $modelValue\n                    ngModelController.$setViewValue(newValue);\n                    // update the local view\n                    ngModelController.$render();\n                }\n\n                // when model change, update our view (just update the div content)\n                ngModelController.$render = function () {\n\n                    var value = ngModelController.$viewValue;\n                    var display = !value || !value.length || !value.trim().length ? \"Please enter a value\" : value;\n                    $element.find('.editable-input-display').text(display);\n                    $element.find('.editable-input-field').val(value);\n                };\n\n                /* ------------- private methods --------------- */\n\n                $scope.edit = function () {\n                    $scope.editing = true;\n                    $timeout(function () {\n                        $element.find('.editable-input-field').focus().select();\n                    }, 200);\n                };\n                $scope.done = function () {\n                    //update display with new value\n                    var value = $element.find('.editable-input-field').val();\n                    update(value);\n                    $scope.editing = false;\n                    $scope.onSave();\n                };\n                $scope.cancel = function () {\n                    //reset input\n                    $element.find('.editable-input-field').val(ngModelController.$viewValue);\n                    $scope.editing = false;\n                };\n\n                $scope.onKeyUp = function ($event, code) {\n                    // console.log(\"Up \" + code);\n                    if ((code === undefined || code === 0) && $event.which !== undefined) code = $event.which;\n                    if (code === 13 && !$scope.error) $scope.done(); //enter\n                    else if (code === 27) $scope.cancel(); //esc\n                };\n            }\n        };\n    }]).directive('imgSelector', function () {\n\n        function base64(file, callback) {\n            var coolFile = {};\n            function readerOnload(e) {\n                var base64 = btoa(e.target.result);\n                coolFile.base64 = base64;\n                callback(coolFile);\n            };\n\n            var reader = new FileReader();\n            reader.onload = readerOnload;\n\n            var file = file[0].files[0];\n            if (file.size > 100000) {\n                alert(\"Image is too large, should be less than 100 KB\");\n                callback(null);\n                return;\n            }\n\n            coolFile.filetype = file.type;\n            coolFile.size = file.size;\n            coolFile.filename = file.name;\n            reader.readAsBinaryString(file);\n        }\n\n        return {\n            scope: {\n                onSave: '&'\n            },\n            require: 'ngModel',\n            template: ['<form class=\"img-selector\">', '  <div class=\"image\" title=\"click to change\">', '    <img src=\"assets/avatar.png\">', '  </div>', '  <button type=\"button\" class=\"btn btn-sm btn-success\" ', '    ng-if=\"imgData && isDirty()\" ng-click=\"save()\">save</button>', '  <input type=\"file\" class=\"hidden\">', '</form>'].join(' '),\n\n            link: function link($scope, $element, $attrs, ngModelController) {\n\n                $scope.isDirty = function () {\n                    return ngModelController.$dirty;\n                };\n\n                function update() {\n                    if (!$scope.imgData) {\n                        return;\n                    }\n                    var image = '<img alt=\"avatar\" src=\"' + $scope.imgData + '\">';\n                    $element.find('.image').html(image);\n                }\n\n                $scope.save = function () {\n                    ngModelController.$setViewValue($scope.imgData);\n                    ngModelController.$setPristine();\n                    $scope.onSave();\n                };\n\n                function onFileSelect() {\n\n                    console.log(\"selecting file\");\n                    base64($element.find('input'), function (data) {\n\n                        if (!data) {\n                            $element.find('form')[0].reset();\n                            return;\n                        }\n\n                        $scope.$apply(function () {\n                            $scope.imgData = 'data:' + data.filetype + ';base64,' + data.base64;\n                            update();\n                            ngModelController.$setDirty();\n                        });\n                    });\n                }\n\n                var filePicker = $element.find('input');\n                $element.find('.image').on('click', function () {\n                    filePicker.trigger('click');\n                });\n                filePicker.on('change', onFileSelect);\n\n                ngModelController.$render = function () {\n                    if (!$scope.imgData) {\n                        $scope.imgData = ngModelController.$viewValue;\n                        update();\n                    }\n                };\n            }\n        };\n    }).controller('LoginController', function ($scope, $uibModalInstance, $timeout, Auth) {\n\n        $timeout(function () {\n            $('#email').focus();\n        }, 500);\n\n        $scope.onKeyUp = function ($event, code) {\n            // console.log(\"Up \" + code);\n            if ((code === undefined || code === 0) && $event.which !== undefined) code = $event.which;\n            if (code === 13 && //enter\n            $scope.email && $scope.password) $scope.login();else if (code === 27) //esc   \n                $scope.cancel();\n        };\n\n        $scope.login = function () {\n\n            Auth.$signInWithEmailAndPassword($scope.email, $scope.password).then(function (authData) {\n                // console.log(\"Logged in\");\n                $scope.errorMessage = null;\n                $uibModalInstance.close();\n            }).catch(function (error) {\n                var errorCode = error.code;\n                $scope.errorMessage = error.message;\n                console.log(\"unable to login: \" + $scope.errorMessage);\n            });\n        };\n\n        $scope.cancel = function () {\n            $uibModalInstance.dismiss('cancel');\n        };\n    }).component('login', {\n\n        template: ['<a ng-if=\"!$ctrl.user\" ng-click=\"$ctrl.doLogin()\">Login</a>', '<a ng-if=\"$ctrl.user\" class=\"dropdown-toggle\" data-toggle=\"dropdown\" ', '  role=\"button\" aria-haspopup=\"true\" aria-expanded=\"false\">', '  <span class=\"hidden-xs\">{{$ctrl.user.email}}</span> ', '  <span class=\"visible-xs-inline-block glyphicon glyphicon-user\"></span>', '  <span class=\"caret\"></span>', '</a>', '<ul ng-if=\"$ctrl.user\" class=\"dropdown-menu\">', '  <li><a ng-click=\"$ctrl.doReset()\">Reset Password</a></li>', '  <li><a ng-click=\"$ctrl.doLogout()\">Log out</a></li>', '</ul>', '</div>'].join(' '),\n\n        controller: function controller($uibModal, $firebaseAuth) {\n            var _this = this;\n\n            this.$onInit = function () {\n                _this.auth = $firebaseAuth();\n                _this.auth.$onAuthStateChanged(function (authData) {\n                    return _this.user = authData;\n                });\n            };\n\n            this.$onDestroy = function () {\n                _this.auth = null;\n            };\n\n            this.doLogout = function () {\n                _this.auth.$signOut(); //v2.x.x\n                _this.user = null;\n            };\n\n            this.doLogin = function () {\n\n                var self = _this;\n                var modalInstance = $uibModal.open({\n                    templateUrl: 'login.html',\n                    controller: 'LoginController',\n                    resolve: {\n                        Auth: function Auth() {\n                            return self.auth;\n                        }\n                    }\n                });\n\n                modalInstance.result.then(function () {}, function () {});\n            };\n\n            this.doReset = function () {\n\n                //v2.x.x\n                auth.$sendPasswordResetEmail(_this.user.email, function (error) {\n                    if (error === null) {\n                        alert(\"Password reset email sent\");\n                    } else {\n                        alert(\"Error sending password reset email:\", error);\n                    }\n                });\n            };\n        }\n\n    }).component('loginMenu', {\n\n        template: ['<div class=\"c-login-menu\">', '  <a ng-if=\"!$ctrl.user\" ng-click=\"$ctrl.doLogin()\">Login</a>', '  <div ng-if=\"$ctrl.user\" class=\"c-login__user\">', '    <small>{{$ctrl.user.email}}</small>', '    <a class=\"btn btn-link\" ng-click=\"$ctrl.doReset()\" title=\"Reset Password\">', '      <span class=\"glyphicon glyphicon-envelope\"></span>', '    </a>', '    <a class=\"btn btn-link\" ng-click=\"$ctrl.doLogout()\" title=\"Log Out\">', '      <span class=\"glyphicon glyphicon-log-out\"></span>', '    </a>', '  </div>', '</div>'].join(' '),\n\n        controller: function controller($uibModal, $firebaseAuth) {\n            var _this2 = this;\n\n            this.$onInit = function () {\n                _this2.auth = $firebaseAuth();\n                _this2.auth.$onAuthStateChanged(function (authData) {\n                    return _this2.user = authData;\n                });\n            };\n\n            this.$onDestroy = function () {\n                _this2.auth = null;\n            };\n\n            this.doLogout = function () {\n                _this2.auth.$signOut(); //v2.x.x\n                _this2.user = null;\n            };\n\n            this.doLogin = function () {\n\n                var self = _this2;\n                var modalInstance = $uibModal.open({\n                    templateUrl: 'login.html',\n                    controller: 'LoginController',\n                    resolve: {\n                        Auth: function Auth() {\n                            return self.auth;\n                        }\n                    }\n                });\n\n                modalInstance.result.then(function () {}, function () {});\n            };\n\n            this.doReset = function () {\n\n                //v2.x.x\n                auth.$sendPasswordResetEmail(_this2.user.email, function (error) {\n                    if (error === null) {\n                        alert(\"Password reset email sent\");\n                    } else {\n                        alert(\"Error sending password reset email:\", error);\n                    }\n                });\n            };\n        }\n\n    }).constant('Templates', ['Pure Mortal', 'Champion of God', 'Changeling', 'Emissary of Power', 'Focused Practitioner', 'Knights of a Faerie Court', 'Lycanthrope', 'Minor Talent', 'Red Court Infected', 'Sorcerer', 'True Believer', 'Were-Form', 'White Court Vampire', 'White Court Virgin', 'Wizard']).constant(\"CharacterShell\", {\n\n        name: \"\",\n        template: \"\",\n        fatePoints: 0,\n\n        powerLevel: \"\",\n        skillCap: 0,\n        baseRefresh: 0,\n\n        adjustedRefresh: 0,\n        aspects: {\n            highConcept: \"\",\n            trouble: \"\",\n            other: \"\"\n        },\n\n        stress: {\n            physical: {\n                0: false,\n                1: false,\n                2: false\n            },\n            mental: {\n                0: false,\n                1: false,\n                2: false\n            },\n            social: {\n                0: false,\n                1: false,\n                2: false\n            },\n            armor: {\n                /*\n                modifier: 2,\n                description: \"\"\n                */\n            }\n        },\n        consequences: {\n            /*\n            \"aspect\": { \n                type: \"mild | moderate | severe | extreme\",\n                modifier: 2 | 4 | 6 | 8,\n                stress: \"any | physical | mental | social\"\n            }\n            */\n        },\n        skills: {\n            total: 0,\n            spent: 0,\n            superb: { choices: \"\" },\n            great: { choices: \"\" },\n            good: { choices: \"\" },\n            fair: { choices: \"\" },\n            average: { choices: \"\" }\n        },\n\n        powers: {\n            /*\n            \"ability\": {\n                cost: \"number\",\n                misc: \"string\"\n            }\n            */\n        },\n\n        phases: {\n            background: {\n                events: \"\",\n                aspect: \"\"\n            },\n            conflict: {\n                events: \"\",\n                aspect: \"\"\n            },\n            story: {\n                events: \"\",\n                aspect: \"\",\n                title: \"\",\n                guest: \"\"\n            },\n            guest1: {\n                events: \"\",\n                aspect: \"\",\n                title: \"\",\n                guest: \"\"\n            },\n            guest2: {\n                events: \"\",\n                aspect: \"\",\n                title: \"\",\n                guest: \"\"\n            }\n        },\n\n        notes: \"\"\n\n    });\n})(angular);\n\n(function (angular) {\n\n    \"use strict\";\n\n    angular.module('dresden', [\"firebase\", 'ui.router', 'ui.bootstrap', 'ngAnimate', 'dresden.common', 'dresden.home', 'dresden.char'])\n\n    /**\n     *\n     */\n    .config(function myAppConfig($locationProvider, $urlRouterProvider) {\n        $urlRouterProvider.otherwise('/');\n        // $locationProvider.html5Mode(true);\n    });\n\n    window.show = function (selector, btn) {\n        $('.c-card').removeClass('is-shown');\n        $(selector).addClass('is-shown');\n        var $btn = $(btn);\n        $btn.addClass('active');\n        $btn.siblings().removeClass('active');\n    };\n})(angular);\n\n(function (angular) {\n\n    \"use strict\";\n\n    angular.module(\"dresden.home\", [\"firebase\", 'dresden.common']).config(function myAppConfig($stateProvider) {\n        $stateProvider.state({\n            name: 'home',\n            url: '/',\n            template: '<home></home>'\n        });\n    });\n})(angular);\n(function (angular) {\n\n    \"use strict\";\n\n    var HomeController = function () {\n        function HomeController(DataStore, CharacterShell, $firebaseAuth, $timeout, $state) {\n            'ngInject';\n\n            _classCallCheck(this, HomeController);\n\n            this.store = DataStore;\n            this.auth = $firebaseAuth();\n            this.blankChar = CharacterShell;\n            this.state = $state;\n        }\n\n        _createClass(HomeController, [{\n            key: '$onInit',\n            value: function $onInit() {\n                var _this3 = this;\n\n                this.displayOpts = {\n                    loading: false,\n                    message: null,\n                    error: null\n                };\n\n                var loadback = function loadback() {\n                    _this3.updateList();\n                    _this3.displayOpts.loading = false;\n                };\n                var errback = function errback(error) {\n                    return _this3.displayOpts.error = \"Failed to load saved data: \" + error.data;\n                };\n\n                var callback = function callback(authData) {\n                    _this3.user = authData;\n\n                    if (authData && authData.uid) {\n                        _this3.displayOpts.loading = true;\n                        _this3.data = _this3.store.getCharsForUser(authData.uid);\n                        _this3.data.$loaded().then(loadback).catch(errback);\n\n                        // this.store.getCharsForUser(authData.uid).then( (data) => {\n                        //     this.data = data;\n                        //     this.updateList();\n                        // }, (error) => {\n                        //     this.displayOpts.error = error.data;\n                        // });\n\n                    } else if (_this3.data) {\n                        _this3.data.$destroy();\n                        _this3.updateList();\n                    }\n                };\n\n                this.auth.$onAuthStateChanged(callback);\n            }\n        }, {\n            key: '$onDestroy',\n            value: function $onDestroy() {\n                this.store = null;\n                this.auth = null;\n                this.blankChar = null;\n                this.state = null;\n            }\n        }, {\n            key: 'updateList',\n            value: function updateList() {\n                if (!this.user) return;\n\n                var id = this.user.uid;\n                var chars = [];\n\n                angular.forEach(this.data, function (value, key) {\n                    if (value.userId && value.userId === id) chars.push(key);\n                });\n                this.chars = chars;\n            }\n        }, {\n            key: 'createCharacter',\n            value: function createCharacter() {\n                var _this4 = this;\n\n                var name = prompt(\"Name the character\", \"Joe Bob\");\n                if (!name) {\n                    alert(\"Characters must have a name\");\n                    return;\n                } else if (this.data[name]) {\n                    alert(\"Name is already in use\");\n                    return;\n                }\n\n                //associate user id for restricting who can edit\n\n                var json = angular.copy(this.blankChar);\n                json.userId = this.user.uid;\n                json.name = name;\n\n                this.data[name] = json;\n                this.data.$save().then(function () {\n\n                    _this4.state.go('char', { id: name });\n\n                    // //navigate to the new char page\n                    // window.location = '#/' + encodeURIComponent(name);\n                }).catch(function (error) {\n                    alert(\"Unable to create character because of an error\");\n                });\n            }\n        }, {\n            key: 'removeChar',\n            value: function removeChar(name) {\n                var _this5 = this;\n\n                this.data[name] = null;\n                this.data.$save().then(function () {\n                    _this5.updateList();\n                });\n            }\n        }]);\n\n        return HomeController;\n    }();\n\n    var app = angular.module(\"dresden.home\").component(\"home\", {\n        templateUrl: 'home/home.component.html',\n        controller: HomeController\n    });\n})(angular);\n(function (angular) {\n\n    \"use strict\";\n\n    var NavController = function () {\n        function NavController(DataStore2, DataStore, CharacterShell, $firebaseAuth, $timeout, $state) {\n            'ngInject';\n\n            // this.store = DataStore2;\n\n            _classCallCheck(this, NavController);\n\n            this.store = DataStore;\n            this.auth = $firebaseAuth();\n            this.blankChar = CharacterShell;\n            this.state = $state;\n            this.timeout = $timeout;\n        }\n\n        _createClass(NavController, [{\n            key: '$onInit',\n            value: function $onInit() {\n                var _this6 = this;\n\n                this.displayOpts = {\n                    loading: false,\n                    message: null,\n                    error: null\n                };\n\n                var loadback = function loadback() {\n                    _this6.updateList();\n                    _this6.displayOpts.loading = false;\n                };\n                var errback = function errback(error) {\n                    return _this6.displayOpts.error = \"Failed to load saved data: \" + error.data;\n                };\n\n                var callback = function callback(authData) {\n                    _this6.user = authData;\n\n                    if (authData && authData.uid) {\n                        _this6.displayOpts.loading = true;\n                        _this6.data = _this6.store.getCharsForUser(authData.uid);\n                        _this6.data.$loaded().then(loadback).catch(errback);\n                    } else if (_this6.data) {\n                        _this6.displayOpts.loading = false;\n                        _this6.data.$destroy();\n                        _this6.updateList();\n                    }\n                };\n\n                this.auth.$onAuthStateChanged(callback);\n            }\n        }, {\n            key: '$onDestroy',\n            value: function $onDestroy() {\n                this.store = null;\n                this.auth = null;\n                this.blankChar = null;\n                this.state = null;\n            }\n        }, {\n            key: 'updateList',\n            value: function updateList() {\n                if (!this.user) return;\n\n                var id = this.user.uid;\n                var chars = [];\n\n                angular.forEach(this.data, function (value, key) {\n                    if (value.userId && value.userId === id) chars.push(key);\n                });\n                this.chars = chars;\n            }\n        }, {\n            key: 'createCharacter',\n            value: function createCharacter() {\n                var _this7 = this;\n\n                var name = prompt(\"Name the character\", \"Joe Bob\");\n                if (!name) {\n                    alert(\"Characters must have a name\");\n                    return;\n                } else if (this.data[name]) {\n                    alert(\"Name is already in use\");\n                    return;\n                }\n\n                //associate user id for restricting who can edit\n\n                var json = angular.copy(this.blankChar);\n                json.userId = this.user.uid;\n                json.name = name;\n\n                /* DATASTORE 1 */\n                this.data[name] = json;\n                this.data.$save().then(function () {\n                    _this7.state.go('char', { id: name });\n                }).catch(function (error) {\n                    alert(\"Unable to create character because of an error\");\n                });\n\n                /* DATASTORE 2 */\n                // this.store.createCharacter(this.user.uid, json);\n                // this.state.go('char', {id: name});\n                // this.timeout( () => {\n                //     this.updateList();\n                // }, 200);\n            }\n        }, {\n            key: 'removeChar',\n            value: function removeChar(name) {\n                var _this8 = this;\n\n                this.data[name] = null;\n                this.data.$save().then(function () {\n                    _this8.updateList();\n                });\n            }\n        }]);\n\n        return NavController;\n    }();\n\n    var app = angular.module(\"dresden.home\").component(\"sidebar\", {\n        templateUrl: 'home/sidebar.component.html',\n        controller: NavController\n    });\n})(angular);\n(function (angular) {\n\n    \"use strict\";\n\n    angular.module(\"dresden.char\", [\"firebase\"]).config(function myAppConfig($stateProvider) {\n        $stateProvider.state({\n            name: 'char',\n            url: '/chars/:id',\n            template: '<character></character>'\n        });\n    }).constant('PowerLevels', {\n        \"Feet in the Water\": {\n            skillCap: 4,\n            baseRefresh: 6\n        },\n        \"Waist Deep\": {\n            skillCap: 4,\n            baseRefresh: 8\n        },\n        \"Other\": {\n            skillCap: 5,\n            baseRefresh: 10\n        }\n    });\n})(angular);\n(function (angular) {\n\n    \"use strict\";\n\n    var AspectsController = function () {\n        function AspectsController() {\n            _classCallCheck(this, AspectsController);\n\n            this.editing = {};\n            this.cache = {};\n        }\n\n        _createClass(AspectsController, [{\n            key: '$onInit',\n            value: function $onInit() {}\n        }, {\n            key: 'edit',\n            value: function edit(aspect) {\n                this.editing[aspect] = true;\n                this.cache[aspect] = this.ngModel.aspects[aspect];\n            }\n        }, {\n            key: 'saveChanges',\n            value: function saveChanges(aspect) {\n                this.onChange(); //trigger save\n                this.editing[aspect] = false;\n                this.cache[aspect] = null;\n            }\n        }, {\n            key: 'abortChanges',\n            value: function abortChanges(aspect) {\n                this.editing[aspect] = false;\n                this.ngModel.aspects[aspect] = this.cache[aspect];\n                this.cache[aspect] = null;\n            }\n        }]);\n\n        return AspectsController;\n    }();\n\n    angular.module(\"dresden.char\").component(\"aspects\", {\n        bindings: {\n            ngModel: \"=\",\n            onChange: \"&\"\n        },\n        templateUrl: 'char/aspects.component.html',\n        controller: AspectsController\n    });\n})(angular);\n(function (angular) {\n\n    \"use strict\";\n\n    var CharController = function () {\n        function CharController(DataStore2, CharacterRef, PowerLevels, Templates, $firebaseAuth, $timeout, $stateParams) {\n            'ngInject';\n\n            _classCallCheck(this, CharController);\n\n            this.charId = $stateParams.id;\n            // this.store = DataStore2;\n            this.store = CharacterRef;\n            this.auth = $firebaseAuth();\n            this.levels = PowerLevels;\n            this.templates = Templates;\n            this.timeout = $timeout;\n        }\n\n        _createClass(CharController, [{\n            key: '$onInit',\n            value: function $onInit() {\n                var _this9 = this;\n\n                this.displayOpts = {\n                    loading: false,\n                    message: null,\n                    error: null\n                };\n\n                var loadback = function loadback() {\n                    _this9.displayOpts.loading = false;\n                    _this9.refresh();\n                };\n                var errback = function errback(error) {\n                    return _this9.displayOpts.error = \"Failed to load character: \" + error.data;\n                };\n\n                var callback = function callback(authData) {\n                    _this9.user = authData;\n\n                    if (authData && authData.uid) {\n                        _this9.displayOpts.loading = true;\n                        _this9.character = _this9.store(_this9.charId);\n                        // this.character = this.store.getCharacter(authData.uid, this.charId);\n                        _this9.character.$loaded().then(loadback).catch(errback);\n                    } else if (_this9.character) {\n                        _this9.character.$destroy();\n                    }\n                };\n\n                this.auth.$onAuthStateChanged(callback);\n            }\n        }, {\n            key: '$onDestroy',\n            value: function $onDestroy() {\n                this.charId = null;\n                this.store = null;\n                this.auth = null;\n                this.levels = null;\n                this.templates = null;\n                this.timeout = null;\n            }\n        }, {\n            key: 'refresh',\n            value: function refresh() {\n                var cost = 0;\n                angular.forEach(this.character.powers, function (power) {\n                    cost += power.cost; //NOTE: costs are negative\n                });\n                this.adjustedRefresh = this.character.baseRefresh + cost;\n            }\n        }, {\n            key: 'onPowerLevelChange',\n            value: function onPowerLevelChange() {\n                var level = this.levels[this.character.powerLevel];\n                this.character.skillCap = level.skillCap;\n                this.character.baseRefresh = level.baseRefresh;\n                this.refresh();\n                this.save();\n            }\n        }, {\n            key: 'save',\n            value: function save() {\n                var _this10 = this;\n\n                if (this.debounce) {\n                    this.timeout.cancel(this.debounce);\n                    this.debounce = null;\n                }\n\n                this.debounce = this.timeout(function () {\n\n                    _this10.debounce = null;\n\n                    _this10.character.$save().then(function () {\n                        _this10.displayOpts.showSave = true;\n                        _this10.timeout(function () {\n                            _this10.displayOpts.showSave = false;\n                        }, 1500);\n                    }, function (error) {\n                        alert(\"There was an error\");\n                    });\n                }, 250);\n            }\n        }]);\n\n        return CharController;\n    }();\n\n    var app = angular.module(\"dresden.char\").component(\"character\", {\n        templateUrl: 'char/char.component.html',\n        controller: CharController\n    });\n})(angular);\n(function (angular) {\n\n    \"use strict\";\n\n    var ConsequencesController = function () {\n        function ConsequencesController() {\n            _classCallCheck(this, ConsequencesController);\n        }\n\n        _createClass(ConsequencesController, [{\n            key: '$onInit',\n            value: function $onInit() {\n                this.displayOpts = {};\n            }\n        }, {\n            key: 'getConsequences',\n            value: function getConsequences() {\n                var result = [];\n                if (this.ngModel) {\n                    for (var aspect in this.ngModel) {\n                        result.push(this.ngModel[aspect]);\n                    }\n                }\n                return result.sort(function (a, b) {\n                    if (a.type === b.type) return a.aspect < b.aspect;else if (a.type === 'mild') return -1;else if (b.type === 'mild') return 1;else if (a.type === 'moderate') return -1;else if (b.type === 'moderate') return 1;else if (a.type === 'severe') return -1;else if (b.type === 'severe') return 1;\n                    return 0;\n                });\n            }\n        }, {\n            key: 'removeConsequence',\n            value: function removeConsequence(consq) {\n                if (consq) {\n                    this.ngModel[consq.aspect] = null;\n                    this.onChange();\n                }\n            }\n        }, {\n            key: 'showConsequenceEditor',\n            value: function showConsequenceEditor() {\n                this.newConsequence = {\n                    aspect: \"\",\n                    type: \"mild\",\n                    modifier: -2\n                };\n                this.displayOpts.showConsequenceEditor = true;\n            }\n        }, {\n            key: 'addConsequence',\n            value: function addConsequence() {\n                this.ngModel = this.ngModel || {};\n                this.ngModel[this.newConsequence.aspect] = this.newConsequence;\n                this.onChange();\n                this.hideConquenceEditor();\n            }\n        }, {\n            key: 'hideConquenceEditor',\n            value: function hideConquenceEditor() {\n                this.newConsequence = null;\n                this.displayOpts.showConsequenceEditor = false;\n            }\n        }, {\n            key: 'updateNewConsequenceModifier',\n            value: function updateNewConsequenceModifier() {\n                var type = this.newConsequence.type;\n                var mod = 'mild' === type ? -2 : 'moderate' === type ? -4 : 'severe' === type ? -6 : -8;\n                this.newConsequence.modifier = mod;\n            }\n        }]);\n\n        return ConsequencesController;\n    }();\n\n    var app = angular.module(\"dresden.char\").component(\"consequences\", {\n        bindings: {\n            ngModel: \"=\",\n            onChange: \"&\"\n        },\n        templateUrl: 'char/consequences.component.html',\n        controller: ConsequencesController\n    });\n})(angular);\n(function (angular) {\n\n    \"use strict\";\n\n    var ItemsController = function () {\n        function ItemsController() {\n            _classCallCheck(this, ItemsController);\n\n            this.displayOpts = {\n                editing: false\n            };\n        }\n\n        _createClass(ItemsController, [{\n            key: '$onInit',\n            value: function $onInit() {}\n        }, {\n            key: 'showEditor',\n            value: function showEditor() {\n                this.displayOpts.editing = true;\n            }\n        }, {\n            key: 'hideEditor',\n            value: function hideEditor() {\n                this.displayOpts.editing = false;\n            }\n        }, {\n            key: 'addItem',\n            value: function addItem() {\n                this.ngModel = this.ngModel || {};\n\n                //if editing existing item, remove old copy in case key (title)\n                // changed. then add updated copy from editor\n                if (this.editingItem) this.ngModel[this.editingItem.title] = null;\n\n                var key = this.newItem.title;\n                key = key.replace(/\\'/g, '').replace(/\\./g, '');\n\n                this.ngModel[key] = this.newItem;\n\n                this.onChange();\n                this.hideEditor();\n                this.newItem = {};\n            }\n        }, {\n            key: 'removeItem',\n            value: function removeItem(item) {\n                if (item) {\n                    this.ngModel[item.title] = null;\n                    this.onChange();\n                }\n            }\n        }, {\n            key: 'editItem',\n            value: function editItem(item) {\n                this.displayOpts.editing = true;\n                this.editingItem = item;\n                this.newItem = angular.copy(item);\n            }\n        }]);\n\n        return ItemsController;\n    }();\n\n    angular.module(\"dresden.char\").component(\"items\", {\n        bindings: {\n            ngModel: \"=\",\n            onChange: \"&\"\n        },\n        templateUrl: 'char/items.component.html',\n        controller: ItemsController\n    });\n})(angular);\n(function (angular) {\n\n    \"use strict\";\n\n    var PhasesController = function () {\n        function PhasesController() {\n            _classCallCheck(this, PhasesController);\n\n            this.editing = {\n                background: {},\n                story: {},\n                conflict: {},\n                guest1: {},\n                guest2: {}\n            };\n            this.cache = {\n                background: {},\n                story: {},\n                conflict: {},\n                guest1: {},\n                guest2: {}\n            };\n        }\n\n        _createClass(PhasesController, [{\n            key: '$onInit',\n            value: function $onInit() {}\n        }, {\n            key: 'edit',\n            value: function edit(phase, property) {\n                this.editing[phase][property] = true;\n                this.cache[phase][property] = this.ngModel[phase][property];\n            }\n        }, {\n            key: 'saveChanges',\n            value: function saveChanges(phase, property) {\n                this.onChange(); //trigger save\n                this.editing[phase][property] = false;\n            }\n        }, {\n            key: 'abortChanges',\n            value: function abortChanges(phase, property) {\n                this.editing[phase][property] = false;\n                this.ngModel[phase][property] = this.cache[phase][property];\n            }\n        }]);\n\n        return PhasesController;\n    }();\n\n    angular.module(\"dresden.char\").component(\"phases\", {\n        bindings: {\n            ngModel: \"=\",\n            onChange: \"&\"\n        },\n        templateUrl: 'char/phases.component.html',\n        controller: PhasesController\n    });\n})(angular);\n(function (angular) {\n\n    \"use strict\";\n\n    var PowersController = function () {\n        function PowersController() {\n            _classCallCheck(this, PowersController);\n        }\n\n        _createClass(PowersController, [{\n            key: '$onInit',\n            value: function $onInit() {\n                this.displayOpts = {};\n            }\n        }, {\n            key: 'removePower',\n            value: function removePower(name) {\n                this.ngModel[name] = null;\n                this.onChange();\n            }\n        }, {\n            key: 'showEditor',\n            value: function showEditor() {\n                this.newPower = {\n                    name: \"\",\n                    cost: 0,\n                    misc: \"\"\n                };\n                this.displayOpts.showEditor = true;\n            }\n        }, {\n            key: 'addPower',\n            value: function addPower() {\n                this.ngModel = this.ngModel || {};\n                this.ngModel[this.newPower.name] = this.newPower;\n                this.onChange();\n                this.hideEditor();\n            }\n        }, {\n            key: 'hideEditor',\n            value: function hideEditor() {\n                this.newPower = null;\n                this.displayOpts.showEditor = false;\n            }\n        }]);\n\n        return PowersController;\n    }();\n\n    angular.module(\"dresden.char\").component(\"powers\", {\n        bindings: {\n            ngModel: \"=\",\n            onChange: \"&\"\n        },\n        templateUrl: 'char/powers.component.html',\n        controller: PowersController\n    });\n})(angular);\n(function (angular) {\n\n    \"use strict\";\n\n    var SkillsController = function () {\n        function SkillsController() {\n            _classCallCheck(this, SkillsController);\n\n            this.editing = {};\n        }\n\n        _createClass(SkillsController, [{\n            key: '$onInit',\n            value: function $onInit() {}\n        }, {\n            key: 'getSkillSlots',\n            value: function getSkillSlots(group) {\n                if (!this.ngModel || !this.ngModel[group]) return 0;\n                var skills = this.ngModel[group].choices;\n                if (!skills || !skills.length) return 0;\n                return skills.split(',').length;\n            }\n\n            /**\n             * @return true if not valid!\n             */\n\n        }, {\n            key: 'validateSpent',\n            value: function validateSpent() {\n                if (!this.ngModel) return false;\n                var spent = this.getSkillSlots('average') + this.getSkillSlots('fair') + this.getSkillSlots('good') + this.getSkillSlots('great') + this.getSkillSlots('superb');\n                return spent > this.ngModel.total;\n            }\n\n            /**\n             * @return true if not valid!\n             */\n\n        }, {\n            key: 'validate',\n            value: function validate(group) {\n                if (!this.ngModel) return false;\n\n                switch (group) {\n                    case 'superb':\n                        return this.getSkillSlots('superb') > this.getSkillSlots('great');\n                    case 'great':\n                        return this.getSkillSlots('great') > this.getSkillSlots('good');\n                    case 'good':\n                        return this.getSkillSlots('good') > this.getSkillSlots('fair');\n                    case 'fair':\n                        return this.getSkillSlots('fair') > this.getSkillSlots('average');\n                }\n                return false; //valid\n            }\n        }, {\n            key: 'edit',\n            value: function edit(group) {\n                this.editing[group] = true;\n                this.cache = this.cache || {};\n                this.cache[group] = this.ngModel[group].choices;\n            }\n        }, {\n            key: 'saveChanges',\n            value: function saveChanges(group) {\n                this.onChange(); //trigger save\n                this.editing[group] = false;\n            }\n        }, {\n            key: 'abortChanges',\n            value: function abortChanges(group) {\n                this.editing[group] = false;\n                this.ngModel[group].choices = this.cache[group];\n            }\n        }]);\n\n        return SkillsController;\n    }();\n\n    angular.module(\"dresden.char\").component(\"skills\", {\n        bindings: {\n            ngModel: \"=\",\n            onChange: \"&\"\n        },\n        templateUrl: 'char/skills.component.html',\n        controller: SkillsController\n    });\n})(angular);\n(function (angular) {\n\n    \"use strict\";\n\n    var StressController = function () {\n        function StressController() {\n            _classCallCheck(this, StressController);\n        }\n\n        _createClass(StressController, [{\n            key: '$onInit',\n            value: function $onInit() {}\n        }, {\n            key: 'resetStress',\n            value: function resetStress() {\n                var _this11 = this;\n\n                angular.forEach(['physical', 'mental', 'social', 'hunger'], function (type) {\n                    var max = _this11.ngModel[type].threshold;\n                    var used = _this11.ngModel[type].used;\n                    for (var index = 0; index < max; ++index) {\n                        used[index] = false;\n                    }\n                });\n                this.onChange();\n            }\n        }, {\n            key: 'toggleStress',\n            value: function toggleStress(type, index) {\n                this.ngModel[type].used[index] = !this.ngModel[type].used[index];\n                this.onChange();\n            }\n        }]);\n\n        return StressController;\n    }();\n\n    angular.module(\"dresden.char\").component(\"stress\", {\n        bindings: {\n            ngModel: \"=\",\n            onChange: \"&\"\n        },\n        templateUrl: 'char/stress.component.html',\n        controller: StressController\n    });\n})(angular);","(function(angular) {\n    \"use strict\";\n\n    angular.module('dresden.common', [])\n\n    .constant('DataStoreUrl', \"https://intense-fire-8692.firebaseio.com/DresdenFiles\")\n\n    .factory(\"DataStore\", [\"$firebaseObject\", 'DataStoreUrl',\n        function($firebaseObject, DataStoreUrl) {\n            return {\n                getCharsForUser: function(uid) {\n                    var root = firebase.database().ref();\n                    var ref = root.child('DresdenFiles').child('chars');\n                    ref.orderByChild('uid').equalTo(uid);\n                    return $firebaseObject(ref);\n                }\n            }\n        }\n    ])\n\n    .factory(\"CharacterRef\", [\"$firebaseObject\", 'DataStoreUrl',\n        function($firebaseObject, DataStoreUrl) {\n            return function(name) {\n                var root = firebase.database().ref();\n                var ref = root.child('DresdenFiles').child('chars').child(name);\n                return $firebaseObject(ref);\n            }\n        }\n    ])\n\n\n\n\n    .factory(\"DataStore2\", [\"$q\", \"$firebaseObject\", 'DataStoreUrl',\n        function($q, $firebaseObject, DataStoreUrl) {\n            return {\n\n                getUserData: function(uid) {\n                    \n                    var deferred = $q.defer();\n\n                    // var root = firebase.database().ref().child('DresdenFiles/users');\n                    // var users = $firebaseObject(root);\n                    // users.$loaded(function() {\n\n                    //     if(!users[uid]) {\n\n                    //         users[uid] = { chars: {} };\n                    //         users.$save().then(function() {\n                    //             deferred.resolve($firebaseObject(users[uid]));\n                    //         }, function(error) {\n                    //             deferred.reject(error);\n                    //         });  \n                    //     } else {\n                    //         deferred.resolve($firebaseObject(users[uid]));\n                    //     }\n                        \n                    // });\n\n                    var ref = firebase.database().ref().child('DresdenFiles/users/' + uid);\n                    var user = $firebaseObject(ref);\n                    user.$loaded(function() {\n                        var exists = user.$value !== null;\n                        if(exists) {\n                            deferred.resolve(user);\n                            return;\n                        }\n                         \n                        var root = firebase.database().ref().child('DresdenFiles/users');\n                        root.child(uid).set({\n                            chars: {},\n                            uid: uid\n                        });\n\n                        user = $firebaseObject(root.child(uid));\n                        deferred.resolve(user);\n                        \n                    });\n\n                    return deferred.promise;\n                },\n\n                getCharsForUser: function(uid) {\n                    var ref = firebase.database().ref().child('DresdenFiles/users/' + uid + '/chars');\n                    return $firebaseObject(ref);\n                },\n\n                getCharacter: function(uid, name) {\n                    var ref = firebase.database().ref().child('DresdenFiles/users/' + uid + '/chars/' + name);\n                    return $firebaseObject(ref);\n                },\n\n                createCharacter: function(uid, character) {\n\n                    var ref = firebase.database().ref().child('DresdenFiles/users/' + uid + '/chars');\n                    ref.child(character.name).set(character);\n                    return $firebaseObject(ref.child(character.name));\n                    \n                }\n            }\n        }\n    ])\n\n\n\n    .filter('encode', function() {\n        return function(value) {\n            return encodeURIComponent(value);\n        };\n    })\n\n    .filter('decode', function() {\n        return function(value) {\n            return decodeURIComponent(value);\n        };\n    })\n\n    .provider('responsiveHelper', [\"$windowProvider\", function ($windowProvider) {\n        \n        var $window  = $windowProvider.$get();\n\n        function Helper($window) {\n            this.window = $window;\n        }\n        Helper.prototype = {\n            getWidth: function() { return $window.innerWidth || $window.outerWidth; },\n            isXS: function () { var width = this.getWidth(); return width < 768; },\n            isSM: function () { var width = this.getWidth(); return width >= 768 && width < 992; },\n            isMD: function () { var width = this.getWidth(); return width >= 992 && width < 1200; },\n            isLG: function () { var width = this.getWidth(); return width >= 1200; }\n        };\n\n        var helper = new Helper($window);\n\n        this.$get = function() {\n            return helper;\n        };\n    }])\n\n    //directive which appends appropriate responsive breakpoint classNames to the element\n    // on which it's set\n    .directive('responsive', ['$window', 'responsiveHelper', function($window, responsiveHelper) {\n\n        return {\n            restrict: \"A\",\n            link: function($scope, $element, $attrs) {\n\n                function update(el, helper) {\n                    if(helper.isXS())\n                        el.addClass('responsive-xs');\n                    else\n                        el.removeClass('responsive-xs');\n\n                    if(helper.isSM())\n                        el.addClass('responsive-sm');\n                    else \n                        el.removeClass('responsive-sm');\n\n                    if(helper.isMD())\n                        el.addClass('responsive-md');\n                    else \n                        el.removeClass('responsive-md');\n\n                    if(helper.isLG())\n                        el.addClass('responsive-lg');\n                    else \n                        el.removeClass('responsive-lg');\n                }\n\n                update($element, responsiveHelper);\n\n                var resizeFn = function() {\n                    update($element, responsiveHelper);\n                };\n\n                var w = angular.element($window);\n                var listener = w.on('resize', resizeFn);\n\n                $scope.$on('$destroy', function() {\n                    w.off('resize', resizeFn);\n                });\n\n            }\n        };\n\n    }])\n\n\n    \n\n    .controller('KeyPad', function ($scope, $uibModalInstance, value, minimum, maximum) {\n\n        $scope.value = value;\n        $scope.minimum = minimum*1 || 0;\n        $scope.maximum = maximum*1 || 9999;\n        \n        $scope.change = function(v) { \n            if(v>0)\n                $scope.value = Math.min($scope.value + v, maximum); \n            else\n                $scope.value = Math.max($scope.value + v, minimum); \n        }\n        \n        $scope.ok = function () {\n            $uibModalInstance.close($scope.value);\n        };\n\n        $scope.cancel = function () {\n            $uibModalInstance.dismiss('cancel');\n        };\n\n    })\n\n\n    .directive('editableStatValue', ['$uibModal', function($uibModal) {\n        return {\n            scope: {\n                onSave: '&',\n                minimum: '@',\n                maximum: '@'\n            },\n            restrict: 'A',\n            require: 'ngModel',\n            replace: true,\n            template: '<div class=\"value\" ng-click=\"openKeypad()\">{{display}}</div>',\n            link: function($scope, $element, $attrs, ngModelController) {\n\n                $scope.minimum = ($scope.minimum || 0)*1;\n                $scope.maximum = ($scope.maximum || 9999)*1;\n\n                ngModelController.$render = function() {\n                    $scope.display = ngModelController.$viewValue;\n                };\n\n                $scope.openKeypad = function() {\n\n                    var value = ngModelController.$modelValue || 0;\n\n                    var modalInstance = $uibModal.open({\n                        templateUrl: 'src/keypad.html',\n                        controller: 'KeyPad',\n                        animation: false,\n                        resolve: {\n                            value: function() { return value; },\n                            minimum: function() { return $scope.minimum; },\n                            maximum: function() { return $scope.maximum; }\n                        }\n                    });\n\n                    modalInstance.result.then(function(value) {\n                        \n                        ngModelController.$setViewValue(value);\n                        ngModelController.$render();\n                        if($scope.onSave)\n                            $scope.onSave();\n\n                    }, function () { });\n\n                };\n            }\n        };\n    }])\n\n\n\n    .directive('editableInput', ['$timeout', function($timeout) {\n\n        return {\n            restrict: 'AE',\n            require: 'ngModel',\n            scope: {\n                label: \"@\",\n                onSave: \"&\"\n            },\n            replace: true,\n            template: [\n                '<div class=\"editable-input\">',\n                '  <label class=\"editable-input-label\">{{::label}}</label>',\n                '  <span class=\"editable-input-display\" ng-show=\"!editing\" ng-click=\"edit()\"></span>',\n\n                '    <form class=\"form\" ng-show=\"editing\">',\n                '      <div class=\"form-group\">',\n                '        <div class=\"grid\">', \n                '          <div class=\"grid__col-auto grid__col--grow-2\">',   \n                '            <input type=\"text\" class=\"form-control editable-input-field\" ',\n                '              ng-keyup=\"onKeyUp($event, $event.keyCode)\"></input>',\n                '          </div>',\n                '          <div class=\"grid__col-auto\">',\n                '            <div class=\"editable-input-buttons\">',\n                '              <button type=\"button\" class=\"btn btn-xs btn-link text-success\" ng-disabled=\"error\" ng-click=\"done()\" tabindex=\"0\">',\n                '                <span class=\"glyphicon glyphicon-ok\"></span>',\n                '              </button>',\n                '              <button type=\"button\" class=\"btn btn-xs btn-link text-danger\" ng-click=\"cancel()\"  tabindex=\"0\">',\n                '                <span class=\"glyphicon glyphicon-remove\"></span>',\n                '              </button>',\n                '            </div>',\n                '          </div>',\n                '        </div>',\n                '      </div>',\n                '    </form>',\n                '</div>'\n            ].join(' '),\n\n            link: function($scope, $element, $attrs, ngModelController) {\n\n                function update(newValue) {\n                    // call $parsers pipeline then update $modelValue\n                    ngModelController.$setViewValue(newValue);\n                    // update the local view\n                    ngModelController.$render();\n                }\n\n                // when model change, update our view (just update the div content)\n                ngModelController.$render = function() {\n\n                    var value = ngModelController.$viewValue;\n                    var display = (!value || !value.length || !value.trim().length) ? \"Please enter a value\" : value;\n                    $element.find('.editable-input-display').text(display);\n                    $element.find('.editable-input-field').val(value);\n                };\n\n\n                /* ------------- private methods --------------- */\n\n                $scope.edit = function() {\n                    $scope.editing=true;\n                    $timeout(function() {\n                        $element.find('.editable-input-field').focus().select();\n                    }, 200);\n                };\n                $scope.done = function() {\n                    //update display with new value\n                    var value = $element.find('.editable-input-field').val();\n                    update(value);\n                    $scope.editing=false;\n                    $scope.onSave();\n                };\n                $scope.cancel = function() {\n                    //reset input\n                    $element.find('.editable-input-field').val(ngModelController.$viewValue);\n                    $scope.editing=false;\n                };\n                \n                $scope.onKeyUp = function($event, code) {\n                    // console.log(\"Up \" + code);\n                    if((code === undefined || code === 0) && $event.which !== undefined)\n                        code = $event.which;\n                    if(code === 13 && !$scope.error) $scope.done();  //enter\n                    else if(code === 27)             $scope.cancel();//esc\n                    \n                };\n\n            }\n        };\n\n    }])\n\n\n\n    .directive('imgSelector', function() {\n\n        function base64(file, callback){\n            var coolFile = {};\n            function readerOnload(e){\n                var base64 = btoa(e.target.result);\n                coolFile.base64 = base64;\n                callback(coolFile)\n            };\n\n            var reader = new FileReader();\n            reader.onload = readerOnload;\n\n            var file = file[0].files[0];\n            if(file.size > 100000) {\n                alert(\"Image is too large, should be less than 100 KB\");\n                callback(null);\n                return;\n            }\n\n            coolFile.filetype = file.type;\n            coolFile.size = file.size;\n            coolFile.filename = file.name;\n            reader.readAsBinaryString(file);\n        }\n\n        return {\n            scope: {\n                onSave: '&'\n            },\n            require: 'ngModel',\n            template: [\n                '<form class=\"img-selector\">',\n                '  <div class=\"image\" title=\"click to change\">',\n                '    <img src=\"assets/avatar.png\">',\n                '  </div>',\n                '  <button type=\"button\" class=\"btn btn-sm btn-success\" ',\n                '    ng-if=\"imgData && isDirty()\" ng-click=\"save()\">save</button>',\n                '  <input type=\"file\" class=\"hidden\">',\n                '</form>'\n            ].join(' '),\n\n            link: function($scope, $element, $attrs, ngModelController) {\n\n                $scope.isDirty = function() {\n                    return ngModelController.$dirty;\n                }\n\n                function update() {\n                    if(!$scope.imgData) {return;}\n                    var image = '<img alt=\"avatar\" src=\"' + $scope.imgData + '\">';\n                    $element.find('.image').html(image);\n                    \n                }\n\n                $scope.save = function() {\n                    ngModelController.$setViewValue($scope.imgData);\n                    ngModelController.$setPristine();\n                    $scope.onSave();\n                }\n                \n                function onFileSelect() {\n\n                    console.log(\"selecting file\");\n                    base64( $element.find('input'), function(data){\n\n                        if(!data) {\n                            $element.find('form')[0].reset();\n                            return;\n                        }\n\n                        $scope.$apply(function() {\n                            $scope.imgData = 'data:' + data.filetype + ';base64,' + data.base64;\n                            update();\n                            ngModelController.$setDirty();\n                        });\n                    });\n\n                }\n\n                var filePicker = $element.find('input');\n                $element.find('.image').on('click', function() {\n                    filePicker.trigger('click');\n                });\n                filePicker.on('change', onFileSelect);\n\n                ngModelController.$render = function() {\n                    if(!$scope.imgData) {\n                        $scope.imgData = ngModelController.$viewValue;\n                        update();\n                    }\n                };\n            }\n        };\n\n    })\n\n\n\n\n\n\n\n    .controller('LoginController', function($scope, $uibModalInstance, $timeout, Auth) {\n\n        $timeout(function() {\n            $('#email').focus();\n        }, 500);\n\n        $scope.onKeyUp = function($event, code) {\n            // console.log(\"Up \" + code);\n            if((code === undefined || code === 0) && $event.which !== undefined)\n                code = $event.which;\n            if(code === 13 &&       //enter\n                $scope.email && \n                $scope.password) \n                $scope.login();  \n            else if(code === 27)    //esc   \n                $scope.cancel();\n            \n        };\n\n        $scope.login = function() {\n            \n            Auth.$signInWithEmailAndPassword($scope.email, $scope.password)\n            .then(function(authData) {\n                // console.log(\"Logged in\");\n                $scope.errorMessage = null;\n                $uibModalInstance.close();\n            })\n            .catch(function(error) {\n                var errorCode = error.code;\n                $scope.errorMessage = error.message;\n                console.log(\"unable to login: \" + $scope.errorMessage);\n            });\n        };\n\n        $scope.cancel = function () {\n            $uibModalInstance.dismiss('cancel');\n        };\n\n    })\n\n\n\n    .component('login', {\n\n        template: [\n                '<a ng-if=\"!$ctrl.user\" ng-click=\"$ctrl.doLogin()\">Login</a>',\n                '<a ng-if=\"$ctrl.user\" class=\"dropdown-toggle\" data-toggle=\"dropdown\" ',\n                '  role=\"button\" aria-haspopup=\"true\" aria-expanded=\"false\">',\n                '  <span class=\"hidden-xs\">{{$ctrl.user.email}}</span> ',\n                '  <span class=\"visible-xs-inline-block glyphicon glyphicon-user\"></span>',\n                '  <span class=\"caret\"></span>',\n                '</a>',\n                '<ul ng-if=\"$ctrl.user\" class=\"dropdown-menu\">',\n                '  <li><a ng-click=\"$ctrl.doReset()\">Reset Password</a></li>',\n                '  <li><a ng-click=\"$ctrl.doLogout()\">Log out</a></li>',\n                '</ul>',\n                '</div>'\n            ].join(' '),\n\n        controller: function($uibModal, $firebaseAuth) {\n\n            this.$onInit = () => {\n                this.auth = $firebaseAuth();\n                this.auth.$onAuthStateChanged( (authData) => this.user = authData );\n            };\n\n            this.$onDestroy = () => {\n                this.auth = null;\n            };\n\n            this.doLogout = () => {\n                this.auth.$signOut();        //v2.x.x\n                this.user = null;\n            };\n\n            this.doLogin = () => {\n\n                var self = this;\n                var modalInstance = $uibModal.open({\n                    templateUrl: 'login.html',\n                    controller: 'LoginController',\n                    resolve: {\n                        Auth: function() { return self.auth; }\n                    }\n                });\n\n                modalInstance.result.then(function() {}, function () {});\n\n            };\n\n            this.doReset = () => {\n\n                //v2.x.x\n                auth.$sendPasswordResetEmail(this.user.email, function(error) {\n                    if (error === null) {\n                        alert(\"Password reset email sent\");\n                    } else {\n                        alert(\"Error sending password reset email:\", error);\n                    }\n                });\n\n            };\n\n        }\n\n    })\n\n\n    .component('loginMenu', {\n\n        template: [\n                '<div class=\"c-login-menu\">',\n                '  <a ng-if=\"!$ctrl.user\" ng-click=\"$ctrl.doLogin()\">Login</a>',\n                '  <div ng-if=\"$ctrl.user\" class=\"c-login__user\">',\n                '    <small>{{$ctrl.user.email}}</small>',\n                '    <a class=\"btn btn-link\" ng-click=\"$ctrl.doReset()\" title=\"Reset Password\">',\n                '      <span class=\"glyphicon glyphicon-envelope\"></span>',\n                '    </a>',\n                '    <a class=\"btn btn-link\" ng-click=\"$ctrl.doLogout()\" title=\"Log Out\">',\n                '      <span class=\"glyphicon glyphicon-log-out\"></span>',\n                '    </a>',\n                '  </div>',\n                '</div>'\n            ].join(' '),\n\n        controller: function($uibModal, $firebaseAuth) {\n\n            this.$onInit = () => {\n                this.auth = $firebaseAuth();\n                this.auth.$onAuthStateChanged( (authData) => this.user = authData );\n            };\n\n            this.$onDestroy = () => {\n                this.auth = null;\n            };\n\n            this.doLogout = () => {\n                this.auth.$signOut();        //v2.x.x\n                this.user = null;\n            };\n\n            this.doLogin = () => {\n\n                var self = this;\n                var modalInstance = $uibModal.open({\n                    templateUrl: 'login.html',\n                    controller: 'LoginController',\n                    resolve: {\n                        Auth: function() { return self.auth; }\n                    }\n                });\n\n                modalInstance.result.then(function() {}, function () {});\n\n            };\n\n            this.doReset = () => {\n\n                //v2.x.x\n                auth.$sendPasswordResetEmail(this.user.email, function(error) {\n                    if (error === null) {\n                        alert(\"Password reset email sent\");\n                    } else {\n                        alert(\"Error sending password reset email:\", error);\n                    }\n                });\n\n            };\n\n        }\n\n    })\n\n\n\n    .constant('Templates', [\n        'Pure Mortal',\n        'Champion of God',\n        'Changeling',\n        'Emissary of Power',\n        'Focused Practitioner',\n        'Knights of a Faerie Court',\n        'Lycanthrope',\n        'Minor Talent',\n        'Red Court Infected',\n        'Sorcerer',\n        'True Believer',\n        'Were-Form',\n        'White Court Vampire',\n        'White Court Virgin',\n        'Wizard'\n    ])\n\n    .constant(\"CharacterShell\", {\n        \n        name: \"\",\n        template: \"\",\n        fatePoints: 0,\n        \n        powerLevel: \"\",\n        skillCap: 0,\n        baseRefresh: 0,\n        \n        adjustedRefresh: 0,\n        aspects: {\n            highConcept: \"\",\n            trouble: \"\",\n            other: \"\"\n        },\n\n        stress: {\n            physical: { \n                0: false,\n                1: false,\n                2: false\n            },\n            mental: { \n                0: false,\n                1: false,\n                2: false\n            },\n            social: { \n                0: false,\n                1: false,\n                2: false\n            },\n            armor: {\n                /*\n                modifier: 2,\n                description: \"\"\n                */\n            }\n        },\n        consequences: {\n            /*\n            \"aspect\": { \n                type: \"mild | moderate | severe | extreme\",\n                modifier: 2 | 4 | 6 | 8,\n                stress: \"any | physical | mental | social\"\n            }\n            */\n        },\n        skills: {\n            total: 0,\n            spent: 0,\n            superb: {choices: \"\"},\n            great: {choices:\"\"},\n            good: {choices:\"\"},\n            fair: {choices:\"\"},\n            average: {choices:\"\"}\n        },\n\n        powers: {\n            /*\n            \"ability\": {\n                cost: \"number\",\n                misc: \"string\"\n            }\n            */\n        },\n\n        phases: {\n            background: {\n                events: \"\",\n                aspect: \"\"\n            },\n            conflict: {\n                events: \"\",\n                aspect: \"\"\n            },\n            story: {\n                events: \"\",\n                aspect: \"\",\n                title: \"\",\n                guest: \"\"\n            },\n            guest1: {\n                events: \"\",\n                aspect: \"\",\n                title: \"\",\n                guest: \"\"\n            },\n            guest2: {\n                events: \"\",\n                aspect: \"\",\n                title: \"\",\n                guest: \"\"\n            }\n        },\n\n        notes: \"\"\n\n    })\n\n\n    ;\n\n}) (angular);\n\n","(function(angular) {\n    \n    \"use strict\";\n\n\n    angular.module('dresden', [\n        \"firebase\", 'ui.router', 'ui.bootstrap', 'ngAnimate', \n        'dresden.common', 'dresden.home', 'dresden.char'\n    ])\n\n    /**\n     *\n     */\n    .config(function myAppConfig ($locationProvider, $urlRouterProvider) {\n        $urlRouterProvider.otherwise('/');\n        // $locationProvider.html5Mode(true);\n    })\n\n    ;\n\n\n    window.show = function(selector, btn) {\n        $('.c-card').removeClass('is-shown');\n        $(selector).addClass('is-shown');\n        var $btn = $(btn);\n        $btn.addClass('active');\n        $btn.siblings().removeClass('active');\n    }\n\n})(angular);\n\n","(function(angular) {\n    \n    \"use strict\";\n\n\n    angular.module(\"dresden.home\", [\"firebase\", 'dresden.common']).config(function myAppConfig ( $stateProvider ) {\n        $stateProvider.state({\n            name: 'home',\n            url: '/',\n            template: '<home></home>'\n        });\n    });\n\n}) (angular);","(function(angular) {\n    \n    \"use strict\";\n\n\n\n    class HomeController {\n\n        constructor (DataStore, CharacterShell, $firebaseAuth, $timeout, $state) {\n            'ngInject';\n\n            this.store = DataStore;\n            this.auth = $firebaseAuth();\n            this.blankChar = CharacterShell;\n            this.state = $state;\n\n        }\n\n        $onInit () {\n            this.displayOpts = {\n                loading: false,\n                message: null,\n                error: null\n            };\n\n            let loadback = () => {\n                this.updateList();\n                this.displayOpts.loading = false;\n            };\n            let errback = (error) => \n                this.displayOpts.error = \"Failed to load saved data: \" + error.data;\n\n            let callback = (authData) => {\n                this.user = authData;\n\n                if(authData && authData.uid) {\n                    this.displayOpts.loading = true;\n                    this.data = this.store.getCharsForUser(authData.uid);\n                    this.data.$loaded().then(loadback).catch(errback);\n\n                    // this.store.getCharsForUser(authData.uid).then( (data) => {\n                    //     this.data = data;\n                    //     this.updateList();\n                    // }, (error) => {\n                    //     this.displayOpts.error = error.data;\n                    // });\n\n\n                } else if(this.data) {\n                    this.data.$destroy();\n                    this.updateList();\n                }\n            };\n\n            this.auth.$onAuthStateChanged(callback);\n        }\n\n        $onDestroy () {\n            this.store = null;\n            this.auth = null;\n            this.blankChar = null;\n            this.state = null;\n        }\n        \n\n        updateList () {\n            if(!this.user) return;\n\n            var id = this.user.uid;\n            var chars = [];\n\n            angular.forEach(this.data, function(value, key) { \n                if(value.userId && value.userId === id)\n                    chars.push(key); \n            });\n            this.chars = chars;\n        }\n\n        createCharacter () {\n\n            var name = prompt(\"Name the character\", \"Joe Bob\");\n            if(!name) {\n                alert(\"Characters must have a name\");\n                return;\n            } else if(this.data[name]) {\n                alert(\"Name is already in use\");\n                return;\n            }\n            \n            //associate user id for restricting who can edit\n\n            var json = angular.copy(this.blankChar);\n            json.userId = this.user.uid;  \n            json.name = name;\n\n            this.data[name] = json;\n            this.data.$save().then( () => {\n                \n                this.state.go('char', {id: name});\n\n                // //navigate to the new char page\n                // window.location = '#/' + encodeURIComponent(name);\n\n            }).catch(function(error) {\n                alert(\"Unable to create character because of an error\");\n            });\n\n        }\n\n        removeChar (name) {\n            this.data[name] = null;\n            this.data.$save().then( () => {\n                this.updateList();\n            });\n        }\n\n    }\n\n\n    var app = angular.module(\"dresden.home\").component(\"home\", {\n        templateUrl: 'home/home.component.html',\n        controller: HomeController\n    });\n\n}) (angular);","(function(angular) {\n    \n    \"use strict\";\n\n\n\n    class NavController {\n\n        constructor (DataStore2, DataStore, CharacterShell, $firebaseAuth, $timeout, $state) {\n            'ngInject';\n\n            // this.store = DataStore2;\n            this.store = DataStore;\n            this.auth = $firebaseAuth();\n            this.blankChar = CharacterShell;\n            this.state = $state;\n            this.timeout = $timeout;\n\n        }\n\n        $onInit () {\n            this.displayOpts = {\n                loading: false,\n                message: null,\n                error: null\n            };\n\n            let loadback = () => {\n                this.updateList();\n                this.displayOpts.loading = false;\n            };\n            let errback = (error) => \n                this.displayOpts.error = \"Failed to load saved data: \" + error.data;\n\n            let callback = (authData) => {\n                this.user = authData;\n\n                if(authData && authData.uid) {\n                    this.displayOpts.loading = true;\n                    this.data = this.store.getCharsForUser(authData.uid);\n                    this.data.$loaded().then(loadback).catch(errback);\n\n                } else if(this.data) {\n                    this.displayOpts.loading = false;\n                    this.data.$destroy();\n                    this.updateList();\n\n                }\n            };\n\n            this.auth.$onAuthStateChanged(callback);\n        }\n\n        $onDestroy () {\n            this.store = null;\n            this.auth = null;\n            this.blankChar = null;\n            this.state = null;\n        }\n        \n\n        updateList () {\n            if(!this.user) return;\n\n            var id = this.user.uid;\n            var chars = [];\n\n            angular.forEach(this.data, function(value, key) { \n                if(value.userId && value.userId === id)\n                    chars.push(key); \n            });\n            this.chars = chars;\n        }\n\n        createCharacter () {\n\n            var name = prompt(\"Name the character\", \"Joe Bob\");\n            if(!name) {\n                alert(\"Characters must have a name\");\n                return;\n            } else if(this.data[name]) {\n                alert(\"Name is already in use\");\n                return;\n            }\n            \n            //associate user id for restricting who can edit\n\n            var json = angular.copy(this.blankChar);\n            json.userId = this.user.uid;  \n            json.name = name;\n\n            /* DATASTORE 1 */\n            this.data[name] = json;\n            this.data.$save().then( () => {\n                this.state.go('char', {id: name});\n            }).catch(function(error) {\n                alert(\"Unable to create character because of an error\");\n            });\n\n\n            /* DATASTORE 2 */\n            // this.store.createCharacter(this.user.uid, json);\n            // this.state.go('char', {id: name});\n            // this.timeout( () => {\n            //     this.updateList();\n            // }, 200);\n            \n        }\n\n        removeChar (name) {\n            this.data[name] = null;\n            this.data.$save().then( () => {\n                this.updateList();\n            });\n        }\n\n    }\n\n\n    var app = angular.module(\"dresden.home\").component(\"sidebar\", {\n        templateUrl: 'home/sidebar.component.html',\n        controller: NavController\n    });\n\n}) (angular);","(function(angular) {\n    \n    \"use strict\";\n\n\n    angular.module(\"dresden.char\", [\"firebase\"]).config(function myAppConfig ( $stateProvider ) {\n        $stateProvider.state({\n            name: 'char',\n            url: '/chars/:id',\n            template: '<character></character>'\n        });\n    })\n\n    .constant('PowerLevels', {\n        \"Feet in the Water\": {\n            skillCap: 4,\n            baseRefresh: 6\n        },\n        \"Waist Deep\": {\n            skillCap: 4,\n            baseRefresh: 8\n        },\n        \"Other\": {\n            skillCap: 5,\n            baseRefresh: 10\n        }\n    });\n\n}) (angular);","(function(angular) {\n    \n    \"use strict\";\n\n\n\n    class AspectsController {\n\n        constructor () {\n            this.editing = {};\n            this.cache = {};\n        }\n\n        $onInit () {\n            \n        }\n\n        edit (aspect) {\n            this.editing[aspect] = true;\n            this.cache[aspect] = this.ngModel.aspects[aspect];\n        }\n\n        saveChanges (aspect) {\n            this.onChange();    //trigger save\n            this.editing[aspect] = false;\n            this.cache[aspect] = null;\n        }\n\n        abortChanges (aspect) {\n            this.editing[aspect] = false;\n            this.ngModel.aspects[aspect] = this.cache[aspect];\n            this.cache[aspect] = null;\n        }\n\n    }\n\n\n\n    angular.module(\"dresden.char\").component(\"aspects\", {\n        bindings: {\n            ngModel: \"=\",\n            onChange: \"&\"\n        },\n        templateUrl: 'char/aspects.component.html',\n        controller: AspectsController\n    });\n\n}) (angular);","(function(angular) {\n    \n    \"use strict\";\n\n\n\n    class CharController {\n\n        constructor (DataStore2, CharacterRef, PowerLevels, Templates, $firebaseAuth, $timeout, $stateParams) {\n            'ngInject';\n\n            this.charId = $stateParams.id;\n            // this.store = DataStore2;\n            this.store = CharacterRef;\n            this.auth = $firebaseAuth();\n            this.levels = PowerLevels;\n            this.templates = Templates;\n            this.timeout = $timeout;\n        }\n\n        $onInit () {\n            this.displayOpts = {\n                loading: false,\n                message: null,\n                error: null\n            };\n\n            let loadback = () => {\n                this.displayOpts.loading = false;\n                this.refresh();\n            };\n            let errback = (error) => \n                this.displayOpts.error = \"Failed to load character: \" + error.data;\n\n            let callback = (authData) => {\n                this.user = authData;\n\n                if(authData && authData.uid) {\n                    this.displayOpts.loading = true;\n                    this.character = this.store(this.charId);\n                    // this.character = this.store.getCharacter(authData.uid, this.charId);\n                    this.character.$loaded().then(loadback).catch(errback);\n\n                } else if(this.character) {\n                    this.character.$destroy();\n                }\n            };\n\n            this.auth.$onAuthStateChanged(callback);\n        }\n\n        $onDestroy () {\n            this.charId = null;\n            this.store = null;\n            this.auth = null;\n            this.levels = null;\n            this.templates = null;\n            this.timeout = null;\n        }\n\n\n        refresh () {\n            var cost = 0;\n            angular.forEach(this.character.powers, (power) => {\n                cost += power.cost; //NOTE: costs are negative\n            });\n            this.adjustedRefresh = this.character.baseRefresh + cost;\n        }\n\n        onPowerLevelChange () {\n            var level = this.levels[this.character.powerLevel];\n            this.character.skillCap = level.skillCap;\n            this.character.baseRefresh = level.baseRefresh;\n            this.refresh();\n            this.save();\n        }\n\n        save () {\n\n            if(this.debounce) {\n                this.timeout.cancel(this.debounce);\n                this.debounce = null;\n            }\n\n            this.debounce = this.timeout( () => {\n\n                this.debounce = null;\n\n                this.character.$save().then(\n                    () => {\n                        this.displayOpts.showSave = true;\n                        this.timeout(() => {this.displayOpts.showSave = false;}, 1500);\n                    }, \n                    (error) => {\n                        alert(\"There was an error\");\n                    });\n\n            },250);\n\n        }\n\n    }\n\n\n\n    var app = angular.module(\"dresden.char\").component(\"character\", {\n        templateUrl: 'char/char.component.html',\n        controller: CharController\n    });\n\n}) (angular);","(function(angular) {\n    \n    \"use strict\";\n\n\n\n    class ConsequencesController {\n\n        constructor () {\n            \n        }\n\n        $onInit () {\n            this.displayOpts = {};\n        }\n\n        getConsequences () {\n            var result = [];\n            if(this.ngModel) {\n                for(var aspect in this.ngModel) {\n                    result.push(this.ngModel[aspect]);\n                }\n            }\n            return result.sort(function(a,b) {\n                if(a.type === b.type) return a.aspect < b.aspect;\n                else if(a.type === 'mild') return -1;\n                else if(b.type === 'mild') return 1;\n                else if(a.type === 'moderate') return -1;\n                else if(b.type === 'moderate') return 1;\n                else if(a.type === 'severe') return -1;\n                else if(b.type === 'severe') return 1;\n                return 0;\n            });\n        }\n\n        removeConsequence (consq) {\n            if(consq) {\n                this.ngModel[consq.aspect] = null;\n                this.onChange();\n            }\n        }\n\n        showConsequenceEditor () {\n            this.newConsequence = {\n                aspect: \"\",\n                type: \"mild\",\n                modifier: -2\n            };\n            this.displayOpts.showConsequenceEditor = true;\n        }\n\n        addConsequence () {\n            this.ngModel = this.ngModel || {};\n            this.ngModel[this.newConsequence.aspect] = this.newConsequence;\n            this.onChange();\n            this.hideConquenceEditor();\n        }\n        \n        hideConquenceEditor () {\n            this.newConsequence = null;\n            this.displayOpts.showConsequenceEditor = false;\n        }\n\n        updateNewConsequenceModifier () {\n            var type = this.newConsequence.type;\n            var mod = 'mild' === type ? -2 : ( 'moderate' === type ? -4 : ( 'severe' === type ? -6 : -8 ) );\n            this.newConsequence.modifier = mod;\n        }\n\n    }\n\n\n\n    var app = angular.module(\"dresden.char\").component(\"consequences\", {\n        bindings: {\n            ngModel: \"=\",\n            onChange: \"&\"\n        },\n        templateUrl: 'char/consequences.component.html',\n        controller: ConsequencesController\n    });\n\n}) (angular);","(function(angular) {\n    \n    \"use strict\";\n\n\n\n    class ItemsController {\n\n        constructor () {\n            this.displayOpts = {\n                editing: false\n            };\n        }\n\n        $onInit () {\n            \n        }\n\n        showEditor () {\n            this.displayOpts.editing = true;\n        }\n\n        hideEditor () {\n            this.displayOpts.editing = false;   \n        }\n\n        addItem () {\n            this.ngModel = this.ngModel || {};\n\n            //if editing existing item, remove old copy in case key (title)\n            // changed. then add updated copy from editor\n            if(this.editingItem) \n                this.ngModel[this.editingItem.title] = null;\n            \n\n            var key = this.newItem.title;\n            key = key.replace(/\\'/g, '').replace(/\\./g, '');\n\n            this.ngModel[key] = this.newItem;\n        \n            this.onChange();\n            this.hideEditor();\n            this.newItem = {};\n        }\n\n        removeItem (item) {\n            if(item) {\n                this.ngModel[item.title] = null;\n                this.onChange();\n            }\n        }\n\n        editItem (item) {\n            this.displayOpts.editing = true;\n            this.editingItem = item;\n            this.newItem = angular.copy(item);\n        }\n\n    }\n\n\n\n    angular.module(\"dresden.char\").component(\"items\", {\n        bindings: {\n            ngModel: \"=\",\n            onChange: \"&\"\n        },\n        templateUrl: 'char/items.component.html',\n        controller: ItemsController\n    });\n\n}) (angular);","(function(angular) {\n    \n    \"use strict\";\n\n\n\n    class PhasesController {\n\n        constructor () {\n            this.editing = {\n                background: {},\n                story: {},\n                conflict: {},\n                guest1: {},\n                guest2: {}\n            };\n            this.cache = {\n                background: {},\n                story: {},\n                conflict: {},\n                guest1: {},\n                guest2: {}\n            };\n        }\n\n        $onInit () {\n            \n        }\n\n        edit (phase, property) {\n            this.editing[phase][property] = true;\n            this.cache[phase][property] = this.ngModel[phase][property];\n        }\n\n        saveChanges (phase, property) {\n            this.onChange();    //trigger save\n            this.editing[phase][property] = false;\n        }\n\n        abortChanges (phase, property) {\n            this.editing[phase][property] = false;\n            this.ngModel[phase][property] = this.cache[phase][property];\n        }\n\n    }\n\n\n\n    angular.module(\"dresden.char\").component(\"phases\", {\n        bindings: {\n            ngModel: \"=\",\n            onChange: \"&\"\n        },\n        templateUrl: 'char/phases.component.html',\n        controller: PhasesController\n    });\n\n}) (angular);","(function(angular) {\n    \n    \"use strict\";\n\n\n\n    class PowersController {\n\n        constructor () {\n            \n        }\n\n        $onInit () {\n            this.displayOpts = {};\n        }\n\n        removePower (name) {\n            this.ngModel[name] = null;\n            this.onChange();\n        }\n\n\n        showEditor () {\n            this.newPower = {\n                name: \"\",\n                cost: 0,\n                misc: \"\"\n            };\n            this.displayOpts.showEditor = true;\n        }\n\n        addPower () {\n            this.ngModel = this.ngModel || {};\n            this.ngModel[this.newPower.name] = this.newPower;\n            this.onChange();\n            this.hideEditor();\n        }\n        \n        hideEditor () {\n            this.newPower = null;\n            this.displayOpts.showEditor = false;\n        }\n\n    }\n\n\n\n    angular.module(\"dresden.char\").component(\"powers\", {\n        bindings: {\n            ngModel: \"=\",\n            onChange: \"&\"\n        },\n        templateUrl: 'char/powers.component.html',\n        controller: PowersController\n    });\n\n}) (angular);","(function(angular) {\n    \n    \"use strict\";\n\n\n\n    class SkillsController {\n\n        constructor () {\n            this.editing = {};\n        }\n\n        $onInit () {\n            \n        }\n\n\n        getSkillSlots (group) {\n            if(!this.ngModel || !this.ngModel[group])\n                return 0;\n            var skills = this.ngModel[group].choices;\n            if(!skills || !skills.length) return 0;\n            return skills.split(',').length;\n        }\n\n        /**\n         * @return true if not valid!\n         */\n        validateSpent () {\n            if(!this.ngModel) return false;\n            var spent = \n                this.getSkillSlots('average') + this.getSkillSlots('fair') + \n                this.getSkillSlots('good') + this.getSkillSlots('great') + \n                this.getSkillSlots('superb');\n            return spent > this.ngModel.total;\n        }\n\n        /**\n         * @return true if not valid!\n         */\n        validate (group) {\n            if(!this.ngModel) return false;\n            \n            switch(group) {\n                case 'superb': \n                    return this.getSkillSlots('superb') > this.getSkillSlots('great');\n                case 'great': \n                    return this.getSkillSlots('great') > this.getSkillSlots('good');\n                case 'good': \n                    return this.getSkillSlots('good') > this.getSkillSlots('fair');\n                case 'fair': \n                    return this.getSkillSlots('fair') > this.getSkillSlots('average');\n            }\n            return false;   //valid\n        }\n\n\n        edit (group) {\n            this.editing[group] = true;\n            this.cache = this.cache || {};\n            this.cache[group] = this.ngModel[group].choices;\n        }\n\n        saveChanges (group) {\n            this.onChange();    //trigger save\n            this.editing[group] = false;\n        }\n\n        abortChanges (group) {\n            this.editing[group] = false;\n            this.ngModel[group].choices = this.cache[group];\n        }\n\n    }\n\n\n\n    angular.module(\"dresden.char\").component(\"skills\", {\n        bindings: {\n            ngModel: \"=\",\n            onChange: \"&\"\n        },\n        templateUrl: 'char/skills.component.html',\n        controller: SkillsController\n    });\n\n}) (angular);","(function(angular) {\n    \n    \"use strict\";\n\n\n\n    class StressController {\n\n        constructor () {\n            \n        }\n\n        $onInit () {\n            \n        }\n\n        resetStress () {\n            angular.forEach(['physical','mental','social','hunger'], (type) => {\n                var max = this.ngModel[type].threshold;\n                var used = this.ngModel[type].used;\n                for(var index=0; index<max; ++index) {\n                    used[index] = false;\n                }\n            });\n            this.onChange();\n        }\n\n        toggleStress (type, index) {\n            this.ngModel[type].used[index] = !this.ngModel[type].used[index];\n            this.onChange();\n        }\n\n    }\n\n\n\n    angular.module(\"dresden.char\").component(\"stress\", {\n        bindings: {\n            ngModel: \"=\",\n            onChange: \"&\"\n        },\n        templateUrl: 'char/stress.component.html',\n        controller: StressController\n    });\n\n}) (angular);"]}